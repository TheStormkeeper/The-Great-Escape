<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at A51C</title>
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="disassembly">
<table class="header">
<tr>
<td class="headerLogo"><a class="link" href="../index.html"><img src="../images/logo.png" alt="The Great Escape" /></a></td>
<td class="headerText">Routines</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="42251.html">A50B</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#42268">Map</a></td>
<td class="next">Next: <a class="link" href="42380.html">A58C</a></td>
</tr>
</table>
<div class="description">A51C: escaped</div>
<table class="disassembly">
<tr>
<td class="routineComment" colspan="3">
<div class="details">
<div class="paragraph">
Print 'well done' message then test to see if the right objects were used in the escape attempt.
</div>
</div>
</td>
</tr>
<tr>
<td class="label"><a name="42268"></a>A51C</td>
<td class="instruction">CALL <a class="link" href="42251.html">$A50B</a></td>
<td class="comment">screen_reset();</td>
</tr>
<tr>
<td class="address"><a name="42271"></a>A51F</td>
<td class="instruction">LD HL,$A5CE</td>
<td class="comment">HL = &amp;screenlocstring_well_done;</td>
</tr>
<tr>
<td class="address"><a name="42274"></a>A522</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // WELL DONE</td>
</tr>
<tr>
<td class="address"><a name="42277"></a>A525</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // YOU HAVE ESCAPED</td>
</tr>
<tr>
<td class="address"><a name="42280"></a>A528</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // FROM THE CAMP</td>
</tr>
<tr>
<td class="address"><a name="42283"></a>A52B</td>
<td class="instruction">LD C,$00</td>
<td class="comment">C = 0; // preserve A</td>
</tr>
<tr>
<td class="address"><a name="42285"></a>A52D</td>
<td class="instruction">LD HL,$8215</td>
<td class="comment">HL = &amp;items_held[0];</td>
</tr>
<tr>
<td class="address"><a name="42288"></a>A530</td>
<td class="instruction">CALL <a class="link" href="42396.html">$A59C</a></td>
<td class="comment">have_required_items();</td>
</tr>
<tr>
<td class="address"><a name="42291"></a>A533</td>
<td class="instruction">INC HL</td>
<td class="comment">HL++; // &amp;items_held[1];</td>
</tr>
<tr>
<td class="address"><a name="42292"></a>A534</td>
<td class="instruction">CALL <a class="link" href="42396.html">$A59C</a></td>
<td class="comment">have_required_items();</td>
</tr>
<tr>
<td class="address"><a name="42295"></a>A537</td>
<td class="instruction">LD A,C</td>
<td class="comment">A = C;</td>
</tr>
<tr>
<td class="address"><a name="42296"></a>A538</td>
<td class="instruction">CP $05</td>
<td class="comment" rowspan="2">if (A == 5) goto success; // 1 + 4 == compass + purse</td>
</tr>
<tr>
<td class="address"><a name="42298"></a>A53A</td>
<td class="instruction">JR Z,$A540</td>
</tr>
<tr>
<td class="address"><a name="42300"></a>A53C</td>
<td class="instruction">CP $03</td>
<td class="comment" rowspan="2">else if (A != 3) goto captured; // 1 + 2 == compass + papers</td>
</tr>
<tr>
<td class="address"><a name="42302"></a>A53E</td>
<td class="instruction">JR NZ,$A54E</td>
</tr>
<tr>
<td class="label"><a name="42304"></a>A540</td>
<td class="instruction">LD HL,$A5FD</td>
<td class="comment">success: HL = &amp;screenlocstring_and_will_cross_the;</td>
</tr>
<tr>
<td class="address"><a name="42307"></a>A543</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // AND WILL CROSS THE</td>
</tr>
<tr>
<td class="address"><a name="42310"></a>A546</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // BORDER SUCCESSFULLY</td>
</tr>
<tr>
<td class="address"><a name="42313"></a>A549</td>
<td class="instruction">LD A,$FF</td>
<td class="comment">A = 0xFF; // success flag</td>
</tr>
<tr>
<td class="address"><a name="42315"></a>A54B</td>
<td class="instruction">PUSH AF</td>
<td class="comment">PUSH AF</td>
</tr>
<tr>
<td class="address"><a name="42316"></a>A54C</td>
<td class="instruction">JR $A56E</td>
<td class="comment">goto press_any_key;</td>
</tr>
<tr>
<td class="label"><a name="42318"></a>A54E</td>
<td class="instruction">PUSH AF</td>
<td class="comment">captured: PUSH AF</td>
</tr>
<tr>
<td class="address"><a name="42319"></a>A54F</td>
<td class="instruction">LD HL,$A628</td>
<td class="comment">HL = &amp;screenlocstring_but_were_recaptured;</td>
</tr>
<tr>
<td class="address"><a name="42322"></a>A552</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // BUT WERE RECAPTURED</td>
</tr>
<tr>
<td class="address"><a name="42325"></a>A555</td>
<td class="instruction">POP AF</td>
<td class="comment">POP AF</td>
</tr>
<tr>
<td class="address"><a name="42326"></a>A556</td>
<td class="instruction">PUSH AF</td>
<td class="comment">PUSH AF</td>
</tr>
<tr>
<td class="address"><a name="42327"></a>A557</td>
<td class="instruction">CP $08</td>
<td class="comment" rowspan="2">if (A &gt;= 8) goto plot; // at least a uniform =&gt; 'but were recaptured'</td>
</tr>
<tr>
<td class="address"><a name="42329"></a>A559</td>
<td class="instruction">JR NC,$A56B</td>
</tr>
<tr>
<td class="address"><a name="42331"></a>A55B</td>
<td class="instruction">LD HL,$A652</td>
<td class="comment">HL = &amp;screenlocstring_totally_unprepared;</td>
</tr>
<tr>
<td class="address"><a name="42334"></a>A55E</td>
<td class="instruction">AND A</td>
<td class="comment" rowspan="2">if (A == 0) goto plot; // no objects =&gt; 'totally unprepared'</td>
</tr>
<tr>
<td class="address"><a name="42335"></a>A55F</td>
<td class="instruction">JR Z,$A56B</td>
</tr>
<tr>
<td class="address"><a name="42337"></a>A561</td>
<td class="instruction">LD HL,$A667</td>
<td class="comment">HL = &amp;screenlocstring_totally_lost;</td>
</tr>
<tr>
<td class="address"><a name="42340"></a>A564</td>
<td class="instruction">BIT 0,A</td>
<td class="comment" rowspan="2">if ((A &amp; (1&lt;&lt;0)) == 0) goto plot; // no compass =&gt; 'totally lost'</td>
</tr>
<tr>
<td class="address"><a name="42342"></a>A566</td>
<td class="instruction">JR Z,$A56B</td>
</tr>
<tr>
<td class="address"><a name="42344"></a>A568</td>
<td class="instruction">LD HL,$A676</td>
<td class="comment">HL = &amp;screenlocstring_due_to_lack_of_papers;</td>
</tr>
<tr>
<td class="label"><a name="42347"></a>A56B</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">plot: screenlocstring_plot();</td>
</tr>
<tr>
<td class="label"><a name="42350"></a>A56E</td>
<td class="instruction">LD HL,$A68E</td>
<td class="comment">press_any_key: HL = &amp;screenlocstring_press_any_key;</td>
</tr>
<tr>
<td class="address"><a name="42353"></a>A571</td>
<td class="instruction">CALL <a class="link" href="42431.html">$A5BF</a></td>
<td class="comment">screenlocstring_plot(); // PRESS ANY KEY</td>
</tr>
<tr>
<td class="label"><a name="42356"></a>A574</td>
<td class="instruction">CALL <a class="link" href="42380.html">$A58C</a></td>
<td class="comment" rowspan="2">do { keyscan_all(); } while (NZ); // wait for up-down keypress?</td>
</tr>
<tr>
<td class="address"><a name="42359"></a>A577</td>
<td class="instruction">JR NZ,$A574</td>
</tr>
<tr>
<td class="label"><a name="42361"></a>A579</td>
<td class="instruction">CALL <a class="link" href="42380.html">$A58C</a></td>
<td class="comment" rowspan="2">do { keyscan_all(); } while (Z);</td>
</tr>
<tr>
<td class="address"><a name="42364"></a>A57C</td>
<td class="instruction">JR Z,$A579</td>
</tr>
<tr>
<td class="address"><a name="42366"></a>A57E</td>
<td class="instruction">POP AF</td>
<td class="comment">POP AF</td>
</tr>
<tr>
<td class="address"><a name="42367"></a>A57F</td>
<td class="instruction">CP $FF</td>
<td class="comment" rowspan="2">if (A == 0xFF) looks_like_a_reset_fn(); return; // exit via</td>
</tr>
<tr>
<td class="address"><a name="42369"></a>A581</td>
<td class="instruction">JP Z,<a class="link" href="46938.html">$B75A</a></td>
</tr>
<tr>
<td class="address"><a name="42372"></a>A584</td>
<td class="instruction">CP $08</td>
<td class="comment" rowspan="2">if (A &gt;= 8) looks_like_a_reset_fn(); return; // exit via</td>
</tr>
<tr>
<td class="address"><a name="42374"></a>A586</td>
<td class="instruction">JP NC,<a class="link" href="46938.html">$B75A</a></td>
</tr>
<tr>
<td class="address"><a name="42377"></a>A589</td>
<td class="instruction">JP <a class="link" href="52120.html">$CB98</a></td>
<td class="comment">solitary(); return; // exit via</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="42251.html">A50B</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#42268">Map</a></td>
<td class="next">Next: <a class="link" href="42380.html">A58C</a></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20130101</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 3.3.</div>
</div>
</body>
</html>