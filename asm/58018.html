<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at E2A2</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="58015.html">E29F</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#58018">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="58190.html">E34E</a></span></td>
</tr>
</table>
<div class="description">E2A2: masked_sprite_plotter_16_wide_case_1</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="47206.html">B866</a>.
</div>
<div class="paragraph">
Sprite plotter. Used for characters and objects.
</div>
<div class="paragraph">
Looks like it plots a two byte-wide sprite with mask into a three byte-wide destination.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="58018"></a>E2A2</td>
<td class="instruction">LD A,(IY+$18)</td>
<td class="comment-11" rowspan="4">if ((A = IY[24] &amp; 7) &gt;= 4) goto masked_sprite_plotter_16_wide_case_2;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58021"></a>E2A5</td>
<td class="instruction">AND $07</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58023"></a>E2A7</td>
<td class="instruction">CP $04</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58025"></a>E2A9</td>
<td class="instruction">JP NC,<a class="link" href="58190.html">$E34E</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="58028"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="58015.html">E29F</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="58028"></a>E2AC</td>
<td class="instruction">CPL</td>
<td class="comment-11" rowspan="6">A = (~A &amp; 3) * 6; // jump table offset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58029"></a>E2AD</td>
<td class="instruction">AND $03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58031"></a>E2AF</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58032"></a>E2B0</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58033"></a>E2B1</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58034"></a>E2B2</td>
<td class="instruction">ADD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58035"></a>E2B3</td>
<td class="instruction">LD ($E2DC),A</td>
<td class="comment-11" rowspan="1">($E2DB + 1) = A; // self-modify - first jump</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58038"></a>E2B6</td>
<td class="instruction">LD ($E2F4),A</td>
<td class="comment-11" rowspan="1">($E2F3 + 1) = A; // self-modify - second jump</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58041"></a>E2B9</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="3">maskptr = mask_pointer; // maskptr = HL'  // observed: $D505 (a mask)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58042"></a>E2BA</td>
<td class="instruction">LD HL,($81AE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58045"></a>E2BD</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58046"></a>E2BE</td>
<td class="instruction">LD HL,($81AC)</td>
<td class="comment-11" rowspan="1">bitmapptr = bitmap_pointer; // bitmapptr = HL  // observed: $D256 (a bitmap)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58049"></a>E2C1</td>
<td class="instruction">LD B,$20</td>
<td class="comment-11" rowspan="1">B = 32; // iterations // height? // self modified</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="58051"></a>E2C3</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="2">do &lt;% bm0 = *bitmapptr++; // D</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58052"></a>E2C4</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58053"></a>E2C5</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="2">bm1 = *bitmapptr++; // E</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58054"></a>E2C6</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58055"></a>E2C7</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="4">mask0 = *maskptr++; // D'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58056"></a>E2C8</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58057"></a>E2C9</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58058"></a>E2CA</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58059"></a>E2CB</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="3">mask1 = *maskptr++; // E'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58060"></a>E2CC</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58061"></a>E2CD</td>
<td class="instruction">PUSH HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58062"></a>E2CE</td>
<td class="instruction">LD A,($81B7)</td>
<td class="comment-11" rowspan="3">if (flip_sprite &amp; (1&lt;&lt;7)) flip_16_masked_pixels();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58065"></a>E2D1</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58066"></a>E2D2</td>
<td class="instruction">CALL M,<a class="link" href="58383.html">$E40F</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58069"></a>E2D5</td>
<td class="instruction">LD HL,($81B0)</td>
<td class="comment-11" rowspan="1">foremaskptr = foreground_mask_pointer;  // observed: $8100 (mask buffer)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="58072"></a>
<div class="comments">
<div class="paragraph">
Shift mask.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58072"></a>E2D8</td>
<td class="instruction">LD C,$FF</td>
<td class="comment-11" rowspan="1">mask2 = 0xFF; // all bits set =&gt; mask OFF (that would match the observed stored mask format)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58074"></a>E2DA</td>
<td class="instruction">SCF</td>
<td class="comment-11" rowspan="1">carry = 1; // mask OFF</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58075"></a>E2DB</td>
<td class="instruction">JR $E2DD</td>
<td class="comment-11" rowspan="1">goto $E2DD; // self modified // jump table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="58077"></a>E2DD</td>
<td class="instruction">RR D</td>
<td class="comment-11" rowspan="1">RR mask0 // 0 // new_carry = mask0 &amp; 1; mask0 = (mask0 &gt;&gt; 1) | (carry &lt;&lt; 7); carry = new_carry;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58079"></a>E2DF</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">RR mask1      // new_carry = mask1 &amp; 1; mask1 = (mask1 &gt;&gt; 1) | (carry &lt;&lt; 7); carry = new_carry;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58081"></a>E2E1</td>
<td class="instruction">RR C</td>
<td class="comment-11" rowspan="1">RR mask2      // new_carry = mask2 &amp; 1; mask2 = (mask2 &gt;&gt; 1) | (carry &lt;&lt; 7); carry = new_carry;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58083"></a>E2E3</td>
<td class="instruction">RR D</td>
<td class="comment-11" rowspan="1">RR mask0 // 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58085"></a>E2E5</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">RR mask1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58087"></a>E2E7</td>
<td class="instruction">RR C</td>
<td class="comment-11" rowspan="1">RR mask2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58089"></a>E2E9</td>
<td class="instruction">RR D</td>
<td class="comment-11" rowspan="1">RR mask0 // 2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58091"></a>E2EB</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">RR mask1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58093"></a>E2ED</td>
<td class="instruction">RR C</td>
<td class="comment-11" rowspan="1">RR mask2</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="58095"></a>
<div class="comments">
<div class="paragraph">
Shift bitmap.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58095"></a>E2EF</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="2">bm2 = 0; // all bits clear =&gt; pixels OFF</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58096"></a>E2F0</td>
<td class="instruction">LD C,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58098"></a>E2F2</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">A &amp;= A; // I do not grok this. Setting carry flag?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58099"></a>E2F3</td>
<td class="instruction">JR $E2F5</td>
<td class="comment-11" rowspan="1">goto $E2F5; // self modified // jump table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="58101"></a>E2F5</td>
<td class="instruction">SRL D</td>
<td class="comment-11" rowspan="1">SRL bm0 // 0 // carry = bm0 &amp; 1; bm0 &gt;&gt;= 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58103"></a>E2F7</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">RR bm1       // new_carry = bm1 &amp; 1; bm1 = (bm1 &gt;&gt; 1) | (carry &lt;&lt; 7); carry = new_carry;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58105"></a>E2F9</td>
<td class="instruction">RR C</td>
<td class="comment-11" rowspan="1">RR bm2       // new_carry = bm2 &amp; 1; bm2 = (bm2 &gt;&gt; 1) | (carry &lt;&lt; 7); carry = new_carry;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58107"></a>E2FB</td>
<td class="instruction">SRL D</td>
<td class="comment-11" rowspan="1">SRL bm0 // 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58109"></a>E2FD</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">RR bm1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58111"></a>E2FF</td>
<td class="instruction">RR C</td>
<td class="comment-11" rowspan="1">RR bm2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58113"></a>E301</td>
<td class="instruction">SRL D</td>
<td class="comment-11" rowspan="1">SRL bm0 // 2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58115"></a>E303</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">RR bm1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58117"></a>E305</td>
<td class="instruction">RR C</td>
<td class="comment-11" rowspan="1">RR bm2</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="58119"></a>
<div class="comments">
<div class="paragraph">
Plot, using foreground mask.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58119"></a>E307</td>
<td class="instruction">LD HL,($81A2)</td>
<td class="comment-11" rowspan="1">screenptr = ($81A2);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58122"></a>E30A</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="13">A = ((~*foremaskptr | mask0) &amp; *screenptr) | (bm0 &amp; *foremaskptr);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58123"></a>E30B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58124"></a>E30C</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58125"></a>E30D</td>
<td class="instruction">OR D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58126"></a>E30E</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58127"></a>E30F</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58128"></a>E310</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58129"></a>E311</td>
<td class="instruction">LD A,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58130"></a>E312</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58131"></a>E313</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58132"></a>E314</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58133"></a>E315</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58134"></a>E316</td>
<td class="instruction">OR D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58135"></a>E317</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">foremaskptr++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58136"></a>E318</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58137"></a>E319</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="2">*screenptr++ = A; // entry point jump0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58138"></a>E31A</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58139"></a>E31B</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="13">A = ((~*foremaskptr | mask1) &amp; *screenptr) | (bm1 &amp; *foremaskptr);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58140"></a>E31C</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58141"></a>E31D</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58142"></a>E31E</td>
<td class="instruction">OR E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58143"></a>E31F</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58144"></a>E320</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58145"></a>E321</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58146"></a>E322</td>
<td class="instruction">LD A,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58147"></a>E323</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58148"></a>E324</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58149"></a>E325</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58150"></a>E326</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58151"></a>E327</td>
<td class="instruction">OR E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58152"></a>E328</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">foremaskptr++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58153"></a>E329</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58154"></a>E32A</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="2">*screenptr++ = A; // entry point jump2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58155"></a>E32B</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58156"></a>E32C</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="13">A = ((~*foremaskptr | mask2) &amp; *screenptr) | (bm2 &amp; *foremaskptr);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58157"></a>E32D</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58158"></a>E32E</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58159"></a>E32F</td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58160"></a>E330</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58161"></a>E331</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58162"></a>E332</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58163"></a>E333</td>
<td class="instruction">LD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58164"></a>E334</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58165"></a>E335</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58166"></a>E336</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58167"></a>E337</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58168"></a>E338</td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58169"></a>E339</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">foremaskptr += 2;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58170"></a>E33A</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58171"></a>E33B</td>
<td class="instruction">LD ($81B0),HL</td>
<td class="comment-11" rowspan="3">foreground_mask_pointer = foremaskptr;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58174"></a>E33E</td>
<td class="instruction">POP HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58175"></a>E33F</td>
<td class="instruction">EXX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58176"></a>E340</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">*screenptr = A; // entry point jump4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58177"></a>E341</td>
<td class="instruction">LD DE,$0016</td>
<td class="comment-11" rowspan="2">screenptr += 22; // stride (24 - 2)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58180"></a>E344</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58181"></a>E345</td>
<td class="instruction">LD ($81A2),HL</td>
<td class="comment-11" rowspan="1">($81A2) = screenptr;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58184"></a>E348</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="3">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58185"></a>E349</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58186"></a>E34A</td>
<td class="instruction">JP NZ,$E2C3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="58189"></a>E34D</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="58015.html">E29F</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#58018">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="58190.html">E34E</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20150123</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>