<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at B14C</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="B107.html">B107</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#b14c">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="B1C7.html">B1C7</a></span></td>
</tr>
</table>
<div class="description">B14C: Check the character is inside of permitted areas.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="AF8F.html">AF8F</a> and <a class="link" href="C4E0.html">C4E0</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Pointer to visible character.</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b14c"></a>B14C</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index) &lt;% interior_bounds_check(); return; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b14f"></a>B14F</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b150"></a>B150</td>
<td class="instruction">JP NZ,<a class="link" href="B29F.html">$B29F</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b153"></a>B153</td>
<td class="instruction">LD B,$18</td>
<td class="comment-11" rowspan="1">B = 24; // 24 iterations (includes walls and fences)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b155"></a>B155</td>
<td class="instruction">LD DE,$B53E</td>
<td class="comment-11" rowspan="1">DE = &amp;walls[0];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b158"></a>B158</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">do &lt;% -</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b159"></a>B159</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b15a"></a>B15A</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="2">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b15b"></a>B15B</td>
<td class="instruction">CALL <a class="link" href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b15e"></a>B15E</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="5">if ((saved_pos_x &gt;= DE[0] * 8 + 2) &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b15f"></a>B15F</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b160"></a>B160</td>
<td class="instruction">LD HL,($81A4)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b163"></a>B163</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b165"></a>B165</td>
<td class="instruction">JR C,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b167"></a>B167</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b168"></a>B168</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b169"></a>B169</td>
<td class="instruction">CALL <a class="link" href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b16c"></a>B16C</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="7">(saved_pos_x &lt;  DE[1] * 8 + 4) &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b16d"></a>B16D</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b16e"></a>B16E</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b16f"></a>B16F</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b170"></a>B170</td>
<td class="instruction">LD HL,($81A4)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b173"></a>B173</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b175"></a>B175</td>
<td class="instruction">JR NC,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b177"></a>B177</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b178"></a>B178</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b179"></a>B179</td>
<td class="instruction">CALL <a class="link" href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b17c"></a>B17C</td>
<td class="instruction">LD HL,($81A6)</td>
<td class="comment-11" rowspan="3">(saved_pos_y &gt;= DE[2] * 8)     &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b17f"></a>B17F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b181"></a>B181</td>
<td class="instruction">JR C,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b183"></a>B183</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b184"></a>B184</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b185"></a>B185</td>
<td class="instruction">CALL <a class="link" href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b188"></a>B188</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="7">(saved_pos_y &lt;  DE[3] * 8 + 4) &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b189"></a>B189</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b18a"></a>B18A</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b18b"></a>B18B</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b18c"></a>B18C</td>
<td class="instruction">LD HL,($81A6)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b18f"></a>B18F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b191"></a>B191</td>
<td class="instruction">JR NC,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b193"></a>B193</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b194"></a>B194</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b195"></a>B195</td>
<td class="instruction">CALL <a class="link" href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b198"></a>B198</td>
<td class="instruction">LD HL,($81A8)</td>
<td class="comment-11" rowspan="3">(saved_height &gt;= DE[4] * 8)     &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b19b"></a>B19B</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b19d"></a>B19D</td>
<td class="instruction">JR C,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b19f"></a>B19F</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1a0"></a>B1A0</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1a1"></a>B1A1</td>
<td class="instruction">CALL <a class="link" href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1a4"></a>B1A4</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="5">(saved_height &lt;  DE[5] * 8 + 2)) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1a5"></a>B1A5</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1a6"></a>B1A6</td>
<td class="instruction">LD HL,($81A8)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1a9"></a>B1A9</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1ab"></a>B1AB</td>
<td class="instruction">JR NC,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b1ad"></a>
<div class="comments">
<div class="paragraph">
Found it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1ad"></a>B1AD</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1ae"></a>B1AE</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1af"></a>B1AF</td>
<td class="instruction">LD A,(IY+$07)</td>
<td class="comment-11" rowspan="3">IY[7] ^= vischar_BYTE7_IMPEDED; // sampled IY = $80A0, $8080, $8060</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1b2"></a>B1B2</td>
<td class="instruction">XOR $20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1b4"></a>B1B4</td>
<td class="instruction">LD (IY+$07),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1b7"></a>B1B7</td>
<td class="instruction">OR $01</td>
<td class="comment-11" rowspan="1">A |= 1; // return NZ</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1b9"></a>B1B9</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b1ba"></a>B1BA</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1bb"></a>B1BB</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1bc"></a>B1BC</td>
<td class="instruction">LD HL,$0006</td>
<td class="comment-11" rowspan="3">DE += 6;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1bf"></a>B1BF</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1c0"></a>B1C0</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1c1"></a>B1C1</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1c2"></a>B1C2</td>
<td class="instruction">JP NZ,$B158</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1c5"></a>B1C5</td>
<td class="instruction">AND B</td>
<td class="comment-11" rowspan="1">A &amp;= B; // return Z</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b1c6"></a>B1C6</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="B107.html">B107</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#b14c">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="B1C7.html">B1C7</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20150622</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.4.</div>
</div>
</body>
</html>