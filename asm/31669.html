<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at 7BB5</title>
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="disassembly">
<table class="header">
<tr>
<td class="headerLogo"><a class="link" href="../index.html"><img src="../images/logo.png" alt="The Great Escape" /></a></td>
<td class="headerText">Routines</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="31627.html">7B8B</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31669">Map</a></td>
<td class="next">Next: <a class="link" href="31782.html">7C26</a></td>
</tr>
</table>
<div class="description">7BB5: drop_item_A</div>
<table class="disassembly">
<tr>
<td class="routineComment" colspan="3">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="45959.html">B387</a>.
</div>
</div>
<table class="input">
<tr>
<td class="register">A</td>
<td class="registerContents">Item.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="label"><a name="31669"></a>7BB5</td>
<td class="instruction">CALL <a class="link" href="31782.html">$7C26</a></td>
<td class="comment">item_to_itemstruct();</td>
</tr>
<tr>
<td class="address"><a name="31672"></a>7BB8</td>
<td class="instruction">INC HL</td>
<td class="comment">HL++;</td>
</tr>
<tr>
<td class="address"><a name="31673"></a>7BB9</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment">A = indoor_room_index;</td>
</tr>
<tr>
<td class="address"><a name="31676"></a>7BBC</td>
<td class="instruction">LD (HL),A</td>
<td class="comment">*HL = A; // set object's room index</td>
</tr>
<tr>
<td class="address"><a name="31677"></a>7BBD</td>
<td class="instruction">AND A</td>
<td class="comment" rowspan="32">if (A == 0) } HL++; PUSH HL {  HL += 2; } POP DE HL = $800F; divide_array_by_8_with_rounding(HL,DE); DE--; {  *DE = 0; } EX DE,HL {  C = (64 + HL[1] - HL[0]) * 2; // itemstruct.x, itemstruct.y; } {  B = 0 - HL[2] - HL[3] - HL[4]; HL += 5; } {  *HL++ = C; } *HL = B; return;</td>
</tr>
<tr>
<td class="address"><a name="31678"></a>7BBE</td>
<td class="instruction">JR NZ,$7BE4</td>
</tr>
<tr>
<td class="routineComment" colspan="3">
<a name="31680"></a>
<div class="comments">
<div class="paragraph">
Outdoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="address">7BC0</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31681"></a>7BC1</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="31682"></a>7BC2</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31683"></a>7BC3</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31684"></a>7BC4</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="address"><a name="31685"></a>7BC5</td>
<td class="instruction">LD HL,$800F</td>
</tr>
<tr>
<td class="address"><a name="31688"></a>7BC8</td>
<td class="instruction">CALL <a class="link" href="58690.html">$E542</a></td>
</tr>
<tr>
<td class="address"><a name="31691"></a>7BCB</td>
<td class="instruction">DEC DE</td>
</tr>
<tr>
<td class="address"><a name="31692"></a>7BCC</td>
<td class="instruction">LD A,$00</td>
</tr>
<tr>
<td class="address"><a name="31694"></a>7BCE</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address"><a name="31695"></a>7BCF</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="routineComment" colspan="3">
<a name="31696"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="52529.html">CD31</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="label">7BD0</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address"><a name="31697"></a>7BD1</td>
<td class="instruction">LD A,$40</td>
</tr>
<tr>
<td class="address"><a name="31699"></a>7BD3</td>
<td class="instruction">ADD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="31700"></a>7BD4</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address"><a name="31701"></a>7BD5</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address"><a name="31702"></a>7BD6</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address"><a name="31703"></a>7BD7</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address"><a name="31704"></a>7BD8</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address"><a name="31705"></a>7BD9</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address"><a name="31706"></a>7BDA</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31707"></a>7BDB</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address"><a name="31708"></a>7BDC</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31709"></a>7BDD</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address"><a name="31710"></a>7BDE</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address"><a name="31711"></a>7BDF</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31712"></a>7BE0</td>
<td class="instruction">LD (HL),C</td>
</tr>
<tr>
<td class="address"><a name="31713"></a>7BE1</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31714"></a>7BE2</td>
<td class="instruction">LD (HL),B</td>
</tr>
<tr>
<td class="address"><a name="31715"></a>7BE3</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routineComment" colspan="3">
<a name="31716"></a>
<div class="comments">
<div class="paragraph">
Indoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="label">7BE4</td>
<td class="instruction">INC HL</td>
<td class="comment">else { HL++;</td>
</tr>
<tr>
<td class="address"><a name="31717"></a>7BE5</td>
<td class="instruction">LD DE,$800F</td>
<td class="comment">DE = $800F; // position on y axis</td>
</tr>
<tr>
<td class="address"><a name="31720"></a>7BE8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment" rowspan="3">*HL++ = *DE;</td>
</tr>
<tr>
<td class="address"><a name="31721"></a>7BE9</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address"><a name="31722"></a>7BEA</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31723"></a>7BEB</td>
<td class="instruction">INC E</td>
<td class="comment" rowspan="2">DE += 2; // position on x axis</td>
</tr>
<tr>
<td class="address"><a name="31724"></a>7BEC</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address"><a name="31725"></a>7BED</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment" rowspan="3">*HL++ = *DE;</td>
</tr>
<tr>
<td class="address"><a name="31726"></a>7BEE</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address"><a name="31727"></a>7BEF</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="31728"></a>7BF0</td>
<td class="instruction">LD (HL),$05</td>
<td class="comment">*HL = 5;</td>
</tr>
<tr>
<td class="routineComment" colspan="3">
<a name="31730"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="52529.html">CD31</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="label">7BF2</td>
<td class="instruction">DEC HL</td>
<td class="comment">HL--;</td>
</tr>
<tr>
<td class="address"><a name="31731"></a>7BF3</td>
<td class="instruction">LD D,$02</td>
<td class="comment" rowspan="2">DE = 0x0200 + HL[0];  // 512 / 8 = 64</td>
</tr>
<tr>
<td class="address"><a name="31733"></a>7BF5</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address"><a name="31734"></a>7BF6</td>
<td class="instruction">EX DE,HL</td>
<td class="comment">EX DE,HL</td>
</tr>
<tr>
<td class="address"><a name="31735"></a>7BF7</td>
<td class="instruction">DEC DE</td>
<td class="comment">DE--;</td>
</tr>
<tr>
<td class="address"><a name="31736"></a>7BF8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment" rowspan="6">HL = (HL - DE[0]) * 2;</td>
</tr>
<tr>
<td class="address"><a name="31737"></a>7BF9</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address"><a name="31738"></a>7BFA</td>
<td class="instruction">LD B,$00</td>
</tr>
<tr>
<td class="address"><a name="31740"></a>7BFC</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address"><a name="31741"></a>7BFD</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="address"><a name="31743"></a>7BFF</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address"><a name="31744"></a>7C00</td>
<td class="instruction">LD C,H</td>
<td class="comment" rowspan="3">A = divide_by_8_with_rounding(H,L);</td>
</tr>
<tr>
<td class="address"><a name="31745"></a>7C01</td>
<td class="instruction">LD A,L</td>
</tr>
<tr>
<td class="address"><a name="31746"></a>7C02</td>
<td class="instruction">CALL <a class="link" href="58704.html">$E550</a></td>
</tr>
<tr>
<td class="address"><a name="31749"></a>7C05</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment">-</td>
</tr>
<tr>
<td class="address"><a name="31750"></a>7C06</td>
<td class="instruction">LD HL,$0800</td>
<td class="comment" rowspan="14">HL = 0x0800 - DE[0] - DE[1] - DE[2]; DE += 2;</td>
</tr>
<tr>
<td class="address"><a name="31753"></a>7C09</td>
<td class="instruction">LD B,$00</td>
</tr>
<tr>
<td class="address"><a name="31755"></a>7C0B</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address"><a name="31756"></a>7C0C</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address"><a name="31757"></a>7C0D</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address"><a name="31758"></a>7C0E</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="address"><a name="31760"></a>7C10</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address"><a name="31761"></a>7C11</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address"><a name="31762"></a>7C12</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address"><a name="31763"></a>7C13</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="address"><a name="31765"></a>7C15</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address"><a name="31766"></a>7C16</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address"><a name="31767"></a>7C17</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address"><a name="31768"></a>7C18</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="address"><a name="31770"></a>7C1A</td>
<td class="instruction">LD C,H</td>
<td class="comment" rowspan="3">Adash = divide_by_8_with_rounding(H,L);</td>
</tr>
<tr>
<td class="address"><a name="31771"></a>7C1B</td>
<td class="instruction">LD A,L</td>
</tr>
<tr>
<td class="address"><a name="31772"></a>7C1C</td>
<td class="instruction">CALL <a class="link" href="58704.html">$E550</a></td>
</tr>
<tr>
<td class="address"><a name="31775"></a>7C1F</td>
<td class="instruction">INC DE</td>
<td class="comment" rowspan="2">DE += 2;</td>
</tr>
<tr>
<td class="address"><a name="31776"></a>7C20</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address"><a name="31777"></a>7C21</td>
<td class="instruction">LD (DE),A</td>
<td class="comment" rowspan="2">*DE-- = Adash;</td>
</tr>
<tr>
<td class="address"><a name="31778"></a>7C22</td>
<td class="instruction">DEC DE</td>
</tr>
<tr>
<td class="address"><a name="31779"></a>7C23</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment">-</td>
</tr>
<tr>
<td class="address"><a name="31780"></a>7C24</td>
<td class="instruction">LD (DE),A</td>
<td class="comment">*DE = A;</td>
</tr>
<tr>
<td class="address"><a name="31781"></a>7C25</td>
<td class="instruction">RET</td>
<td class="comment">return; }</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="31627.html">7B8B</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31669">Map</a></td>
<td class="next">Next: <a class="link" href="31782.html">7C26</a></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20130626</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 3.3.2.</div>
</div>
</body>
</html>