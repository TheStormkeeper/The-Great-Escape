<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at C651</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="50643.html">C5D3</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#50769">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="50848.html">C6A0</a></span></td>
</tr>
</table>
<div class="description">C651: sub_C651</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
...
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to characterstruct + 5. // sampled = $768E, 7695, 769C, 7617, 761E, 7625, 762C, 7633, 7656, 765D</td>
</tr>
</table>
<table class="output-1">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">0/255</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to somewhere in word_783A.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50769"></a>C651</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50770"></a>C652</td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="11">if (A == 0xFF) } {  A = *++HL &amp; characterstruct_BYTE6_MASK_HI; } *HL = A; get_A_indexed_by_C41A(); A &amp;= characterstruct_BYTE6_MASK_LO; A += *HL; {  *HL = A; }</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50772"></a>C654</td>
<td class="instruction">JR NZ,$C664</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50774"></a>C656</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50775"></a>C657</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50776"></a>C658</td>
<td class="instruction">AND $F8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50778"></a>C65A</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50779"></a>C65B</td>
<td class="instruction">CALL <a class="link" href="52101.html">$CB85</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50782"></a>C65E</td>
<td class="instruction">AND $07</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50784"></a>C660</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50785"></a>C661</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50786"></a>C662</td>
<td class="instruction">JR $C692</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50788"></a>C664</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">else { PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50789"></a>C665</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">C = *++HL; // byte6</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50790"></a>C666</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50791"></a>C667</td>
<td class="instruction">CALL <a class="link" href="52089.html">$CB79</a></td>
<td class="comment-11" rowspan="1">DE = element_A_of_table_7738(A);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50794"></a>C66A</td>
<td class="instruction">LD H,$00</td>
<td class="comment-11" rowspan="1">H = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50796"></a>C66C</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1">A = C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50797"></a>C66D</td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="3">if (A == 0xFF) H--; // H = 0xFF</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50799"></a>C66F</td>
<td class="instruction">JR NZ,$C672</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50801"></a>C671</td>
<td class="instruction">DEC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50802"></a>C672</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">L = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50803"></a>C673</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">HL += DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50804"></a>C674</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50805"></a>C675</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50806"></a>C676</td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="1">if (A == 0xFF) ...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50808"></a>C678</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL // interleaved</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50809"></a>C679</td>
<td class="instruction">JR Z,$C69D</td>
<td class="comment-11" rowspan="1">... goto return_255;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50811"></a>C67B</td>
<td class="instruction">AND $7F</td>
<td class="comment-11" rowspan="1">A &amp;= 0x7F;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50813"></a>C67D</td>
<td class="instruction">CP $28</td>
<td class="comment-11" rowspan="10">if (A &lt; 40) } A = *DE; {    if (*HL &amp; (1&lt;&lt;7)) A ^= 0x80; // 762C, 8002, 7672, 7679, 7680, 76A3, 76AA, 76B1, 76B8, 76BF, ... looks quite general} transition(); HL++; A = 0x80; return;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50815"></a>C67F</td>
<td class="instruction">JR NC,$C68F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50817"></a>C681</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50818"></a>C682</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50820"></a>C684</td>
<td class="instruction">JR Z,$C688</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50822"></a>C686</td>
<td class="instruction">XOR $80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50824"></a>C688</td>
<td class="instruction">CALL <a class="link" href="27154.html">$6A12</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50827"></a>C68B</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50828"></a>C68C</td>
<td class="instruction">LD A,$80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50830"></a>C68E</td>
<td class="instruction">RET</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50831"></a>C68F</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE - 40;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50832"></a>C690</td>
<td class="instruction">SUB $28</td>
<td class="comment-11" rowspan="1">}</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="50834"></a>
<div class="comments">
<div class="paragraph">
sample A=$38,2D,02,06,1E,20,21,3C,23,2B,3A,0B,2D,04,03,1C,1B,21,3C,...
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50834"></a>C692</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="6">HL = word_783A[A];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50835"></a>C693</td>
<td class="instruction">LD HL,$783A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50838"></a>C696</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50839"></a>C697</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50840"></a>C698</td>
<td class="instruction">JR NC,$C69B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50842"></a>C69A</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50843"></a>C69B</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">A = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50844"></a>C69C</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="50845"></a>C69D</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-11" rowspan="1">return_255: A = 255;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="50847"></a>C69F</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="50643.html">C5D3</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#50769">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="50848.html">C6A0</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20140530</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>