<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at B5CE</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="B586.html">B586</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#b5ce">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="B71B.html">B71B</a></span></td>
</tr>
</table>
<div class="description">B5CE: (unknown) called_from_main_loop_9</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="6939.html">6939</a> and <a class="link" href="9D7B.html">9D7B</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b5ce"></a>B5CE</td>
<td class="instruction">LD B,$08</td>
<td class="comment-11" rowspan="1">B = 8;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5d0"></a>B5D0</td>
<td class="instruction">LD IY,$8000</td>
<td class="comment-11" rowspan="1">IY = $8000;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b5d4"></a>B5D4</td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-11" rowspan="3">do &lt;% if (IY[1] == vischar_FLAGS_EMPTY_SLOT) goto next; // $8001 flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5d7"></a>B5D7</td>
<td class="instruction">CP $FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5d9"></a>B5D9</td>
<td class="instruction">JP Z,$B6B4</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5dc"></a>B5DC</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">PUSH BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5dd"></a>B5DD</td>
<td class="instruction">SET 7,(IY+$01)</td>
<td class="comment-11" rowspan="1">IY[1] |= vischar_FLAGS_NO_COLLIDE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5e1"></a>B5E1</td>
<td class="instruction">BIT 7,(IY+$0D)</td>
<td class="comment-11" rowspan="2">if (IY[0x0D] &amp; input_KICK) goto kicked; // $800D</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5e5"></a>B5E5</td>
<td class="instruction">JP NZ,$B6BE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5e8"></a>B5E8</td>
<td class="instruction">LD H,(IY+$0B)</td>
<td class="comment-11" rowspan="1">H = IY[0x0B];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5eb"></a>B5EB</td>
<td class="instruction">LD L,(IY+$0A)</td>
<td class="comment-11" rowspan="1">L = IY[0x0A]; // HL = character_related_pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5ee"></a>B5EE</td>
<td class="instruction">LD A,(IY+$0C)</td>
<td class="comment-11" rowspan="1">A = IY[0x0C];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5f1"></a>B5F1</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A &amp; vischar_BYTE12_BIT7) &lt;% // up/down flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5f2"></a>B5F2</td>
<td class="instruction">JP P,$B64F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5f5"></a>B5F5</td>
<td class="instruction">AND $7F</td>
<td class="comment-11" rowspan="1">A &amp;= vischar_BYTE12_MASK;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5f7"></a>B5F7</td>
<td class="instruction">JP Z,$B6C2</td>
<td class="comment-11" rowspan="1">if (A == 0) goto end_bit;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5fa"></a>B5FA</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="7">HL += (A + 1) * 4 - 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5fb"></a>B5FB</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5fc"></a>B5FC</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5fd"></a>B5FD</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b5fe"></a>B5FE</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b600"></a>B600</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b601"></a>B601</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b602"></a>B602</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL++; // a spriteindex_t</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b603"></a>B603</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="2">EX AF,AF'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b604"></a>B604</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b605"></a>B605</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">decrement: EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b606"></a>B606</td>
<td class="instruction">LD L,(IY+$0F)</td>
<td class="comment-11" rowspan="1">L = IY[0x0F]; // X axis</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b609"></a>B609</td>
<td class="instruction">LD H,(IY+$10)</td>
<td class="comment-11" rowspan="1">H = IY[0x10];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b60c"></a>B60C</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE; // sampled DE = $CF9A, $CF9E, $CFBE, $CFC2, $CFB2, $CFB6, $CFA6, $CFAA (character_related_data)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b60d"></a>B60D</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b60e"></a>B60E</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">A &amp;= 0x80;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b610"></a>B610</td>
<td class="instruction">JR Z,$B614</td>
<td class="comment-11" rowspan="2">if (A) A = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b612"></a>B612</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b614"></a>B614</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">B = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b615"></a>B615</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">HL -= BC;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b617"></a>B617</td>
<td class="instruction">LD ($81A4),HL</td>
<td class="comment-11" rowspan="1">saved_pos_x = HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b61a"></a>B61A</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b61b"></a>B61B</td>
<td class="instruction">LD L,(IY+$11)</td>
<td class="comment-11" rowspan="1">L = IY[0x11]; // Y axis</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b61e"></a>B61E</td>
<td class="instruction">LD H,(IY+$12)</td>
<td class="comment-11" rowspan="1">H = IY[0x12];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b621"></a>B621</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b622"></a>B622</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b623"></a>B623</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">A &amp;= 0x80;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b625"></a>B625</td>
<td class="instruction">JR Z,$B629</td>
<td class="comment-11" rowspan="2">if (A) A = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b627"></a>B627</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b629"></a>B629</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">B = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b62a"></a>B62A</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">HL -= BC;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b62c"></a>B62C</td>
<td class="instruction">LD ($81A6),HL</td>
<td class="comment-11" rowspan="1">saved_pos_y = HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b62f"></a>B62F</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b630"></a>B630</td>
<td class="instruction">LD L,(IY+$13)</td>
<td class="comment-11" rowspan="1">L = IY[0x13]; // height</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b633"></a>B633</td>
<td class="instruction">LD H,(IY+$14)</td>
<td class="comment-11" rowspan="1">H = IY[0x14];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b636"></a>B636</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b637"></a>B637</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b638"></a>B638</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">A &amp;= 0x80;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b63a"></a>B63A</td>
<td class="instruction">JR Z,$B63E</td>
<td class="comment-11" rowspan="2">if (A) A = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b63c"></a>B63C</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b63e"></a>B63E</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">B = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b63f"></a>B63F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">HL -= BC;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b641"></a>B641</td>
<td class="instruction">LD ($81A8),HL</td>
<td class="comment-11" rowspan="1">saved_height = HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b644"></a>B644</td>
<td class="instruction">CALL <a class="link" href="AF8F.html">$AF8F</a></td>
<td class="comment-11" rowspan="1">touch();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b647"></a>B647</td>
<td class="instruction">JP NZ,$B6A8</td>
<td class="comment-11" rowspan="1">if (!Z) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b64a"></a>B64A</td>
<td class="instruction">DEC (IY+$0C)</td>
<td class="comment-11" rowspan="1">IY[0x0C]--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b64d"></a>B64D</td>
<td class="instruction">JR $B6A2</td>
<td class="comment-11" rowspan="1">%&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b64f"></a>B64F</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="2">else &lt;% if (A == *HL) goto end_bit;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b650"></a>B650</td>
<td class="instruction">JP Z,$B6C2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b653"></a>B653</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="6">HL += (A + 1) * 4;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b654"></a>B654</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b655"></a>B655</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b656"></a>B656</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b657"></a>B657</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b659"></a>B659</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b65a"></a>B65A</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">increment: EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b65b"></a>B65B</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b65c"></a>B65C</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">L = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b65d"></a>B65D</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">A &amp;= 0x80;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b65f"></a>B65F</td>
<td class="instruction">JR Z,$B663</td>
<td class="comment-11" rowspan="2">if (A) A = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b661"></a>B661</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b663"></a>B663</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">H = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b664"></a>B664</td>
<td class="instruction">LD C,(IY+$0F)</td>
<td class="comment-11" rowspan="1">C = IY[0x0F]; // X axis</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b667"></a>B667</td>
<td class="instruction">LD B,(IY+$10)</td>
<td class="comment-11" rowspan="1">B = IY[0x10];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b66a"></a>B66A</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">HL += BC;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b66b"></a>B66B</td>
<td class="instruction">LD ($81A4),HL</td>
<td class="comment-11" rowspan="1">saved_pos_x = HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b66e"></a>B66E</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b66f"></a>B66F</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b670"></a>B670</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">L = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b671"></a>B671</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">A &amp;= 0x80;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b673"></a>B673</td>
<td class="instruction">JR Z,$B677</td>
<td class="comment-11" rowspan="2">if (A) A = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b675"></a>B675</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b677"></a>B677</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">H = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b678"></a>B678</td>
<td class="instruction">LD C,(IY+$11)</td>
<td class="comment-11" rowspan="1">C = IY[0x11]; // Y axis</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b67b"></a>B67B</td>
<td class="instruction">LD B,(IY+$12)</td>
<td class="comment-11" rowspan="1">B = IY[0x12];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b67e"></a>B67E</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">HL += BC;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b67f"></a>B67F</td>
<td class="instruction">LD ($81A6),HL</td>
<td class="comment-11" rowspan="1">saved_pos_y = HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b682"></a>B682</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b683"></a>B683</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b684"></a>B684</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">L = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b685"></a>B685</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1">A &amp;= 0x80;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b687"></a>B687</td>
<td class="instruction">JR Z,$B68B</td>
<td class="comment-11" rowspan="2">if (A) A = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b689"></a>B689</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b68b"></a>B68B</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">H = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b68c"></a>B68C</td>
<td class="instruction">LD C,(IY+$13)</td>
<td class="comment-11" rowspan="1">C = IY[0x13]; // height</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b68f"></a>B68F</td>
<td class="instruction">LD B,(IY+$14)</td>
<td class="comment-11" rowspan="1">B = IY[0x14];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b692"></a>B692</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">HL += BC;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b693"></a>B693</td>
<td class="instruction">LD ($81A8),HL</td>
<td class="comment-11" rowspan="1">saved_height = HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b696"></a>B696</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b697"></a>B697</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE; // sprite_index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b698"></a>B698</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b699"></a>B699</td>
<td class="instruction">CALL <a class="link" href="AF8F.html">$AF8F</a></td>
<td class="comment-11" rowspan="1">touch();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b69c"></a>B69C</td>
<td class="instruction">JP NZ,$B6A8</td>
<td class="comment-11" rowspan="1">if (!Z) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b69f"></a>B69F</td>
<td class="instruction">INC (IY+$0C)</td>
<td class="comment-11" rowspan="1">IY[0x0C]++; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b6a2"></a>B6A2</td>
<td class="instruction">PUSH IY</td>
<td class="comment-11" rowspan="2">HL = IY;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6a4"></a>B6A4</td>
<td class="instruction">POP HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6a5"></a>B6A5</td>
<td class="instruction">CALL <a class="link" href="B729.html">$B729</a></td>
<td class="comment-11" rowspan="1">calc_vischar_screenpos();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b6a8"></a>B6A8</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">pop_next: POP BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6a9"></a>B6A9</td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-11" rowspan="4">if (IY[1] != vischar_FLAGS_EMPTY_SLOT) IY[1] &amp;= ~vischar_FLAGS_NO_COLLIDE; // $8001</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ac"></a>B6AC</td>
<td class="instruction">CP $FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ae"></a>B6AE</td>
<td class="instruction">JR Z,$B6B4</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6b0"></a>B6B0</td>
<td class="instruction">RES 7,(IY+$01)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b6b4"></a>B6B4</td>
<td class="instruction">LD DE,$0020</td>
<td class="comment-11" rowspan="1">next: DE = 32; // stride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6b7"></a>B6B7</td>
<td class="instruction">ADD IY,DE</td>
<td class="comment-11" rowspan="1">IY += DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6b9"></a>B6B9</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ba"></a>B6BA</td>
<td class="instruction">JP NZ,$B5D4</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6bd"></a>B6BD</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b6be"></a>B6BE</td>
<td class="instruction">RES 7,(IY+$0D)</td>
<td class="comment-11" rowspan="1">kicked: IY[0x0D] &amp;= ~input_KICK; // sampled IY = $8020, $80A0, $8060, $80E0, $8080,</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b6c2"></a>B6C2</td>
<td class="instruction">LD A,(IY+$0E)</td>
<td class="comment-11" rowspan="12">end_bit: A = byte_CDAA[IY[0x0E] * 9 + IY[0x0D]];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6c5"></a>B6C5</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6c6"></a>B6C6</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6c7"></a>B6C7</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6c8"></a>B6C8</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6c9"></a>B6C9</td>
<td class="instruction">ADD A,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ca"></a>B6CA</td>
<td class="instruction">ADD A,(IY+$0D)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6cd"></a>B6CD</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ce"></a>B6CE</td>
<td class="instruction">LD D,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6d0"></a>B6D0</td>
<td class="instruction">LD HL,$CDAA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6d3"></a>B6D3</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6d4"></a>B6D4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6d5"></a>B6D5</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6d6"></a>B6D6</td>
<td class="instruction">LD L,(IY+$08)</td>
<td class="comment-11" rowspan="1">L = IY[0x08];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6d9"></a>B6D9</td>
<td class="instruction">LD H,(IY+$09)</td>
<td class="comment-11" rowspan="1">H = IY[0x09];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6dc"></a>B6DC</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="3">HL += A * 2;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6dd"></a>B6DD</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6de"></a>B6DE</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6df"></a>B6DF</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="2">E = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6e0"></a>B6E0</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6e1"></a>B6E1</td>
<td class="instruction">LD (IY+$0A),E</td>
<td class="comment-11" rowspan="1">IY[0x0A] = E;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6e4"></a>B6E4</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="1">D = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6e5"></a>B6E5</td>
<td class="instruction">LD (IY+$0B),D</td>
<td class="comment-11" rowspan="1">IY[0x0B] = D;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6e8"></a>B6E8</td>
<td class="instruction">BIT 7,C</td>
<td class="comment-11" rowspan="2">if ((C &amp; (1&lt;&lt;7)) == 0) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ea"></a>B6EA</td>
<td class="instruction">JR NZ,$B6FC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6ec"></a>B6EC</td>
<td class="instruction">LD (IY+$0C),$00</td>
<td class="comment-11" rowspan="1">IY[0x0C] = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f0"></a>B6F0</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="2">DE += 2;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f1"></a>B6F1</td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f2"></a>B6F2</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="2">IY[0x0E] = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f3"></a>B6F3</td>
<td class="instruction">LD (IY+$0E),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f6"></a>B6F6</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="2">DE += 2; // point to groups of four</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f7"></a>B6F7</td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f8"></a>B6F8</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6f9"></a>B6F9</td>
<td class="instruction">JP $B65A</td>
<td class="comment-11" rowspan="1">goto increment; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b6fc"></a>B6FC</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">else &lt;% A = *DE; // count of four-byte groups</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6fd"></a>B6FD</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b6fe"></a>B6FE</td>
<td class="instruction">OR $80</td>
<td class="comment-11" rowspan="2">IY[0x0C] = A | vischar_BYTE12_BIT7;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b700"></a>B700</td>
<td class="instruction">LD (IY+$0C),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b703"></a>B703</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">IY[0x0E] = *++DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b704"></a>B704</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b705"></a>B705</td>
<td class="instruction">LD (IY+$0E),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b708"></a>B708</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3">DE += 3; // point to groups of four</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b709"></a>B709</td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b70a"></a>B70A</td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b70b"></a>B70B</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">PUSH DE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b70c"></a>B70C</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b70d"></a>B70D</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="7">HL += C * 4 - 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b70e"></a>B70E</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b70f"></a>B70F</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b710"></a>B710</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b711"></a>B711</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b713"></a>B713</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b714"></a>B714</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b715"></a>B715</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b716"></a>B716</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b717"></a>B717</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b718"></a>B718</td>
<td class="instruction">JP $B605</td>
<td class="comment-11" rowspan="1">goto decrement; %&gt;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="B586.html">B586</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#b5ce">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="B71B.html">B71B</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20150622</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.4.</div>
</div>
</body>
</html>