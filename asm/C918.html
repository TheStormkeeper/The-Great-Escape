<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at C918</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="C892.html">C892</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#c918">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="CA11.html">CA11</a></span></td>
</tr>
</table>
<div class="description">C918: Character behaviour stuff.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="C4E0.html">C4E0</a> and <a class="link" href="C892.html">C892</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Pointer to visible character.</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c918"></a>C918</td>
<td class="instruction">LD A,(IY+$07)</td>
<td class="comment-11" rowspan="1">A = IY[7]; // $8007 etc. // more flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c91b"></a>C91B</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">B = A;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c91c"></a>
<div class="comments">
<div class="paragraph">
If the bottom nibble is set then decrement it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c91c"></a>C91C</td>
<td class="instruction">AND $0F</td>
<td class="comment-11" rowspan="1">A &amp;= vischar_BYTE7_MASK_LO;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c91e"></a>C91E</td>
<td class="instruction">JR Z,$C925</td>
<td class="comment-11" rowspan="1">if (A) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c920"></a>C920</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">IY[7] = --B; // decrement but don't affect flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c921"></a>C921</td>
<td class="instruction">LD (IY+$07),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c924"></a>C924</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c925"></a>C925</td>
<td class="instruction">PUSH IY</td>
<td class="comment-11" rowspan="2">HL = IY;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c927"></a>C927</td>
<td class="instruction">POP HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c928"></a>C928</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">A = *++HL; // incremented HL is $8021 $8041 $8061</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c929"></a>C929</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c92a"></a>C92A</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A != 0) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c92b"></a>C92B</td>
<td class="instruction">JP Z,$C9BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c92e"></a>C92E</td>
<td class="instruction">CP $01</td>
<td class="comment-11" rowspan="2">if (A == vischar_FLAGS_BRIBE_PENDING) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c930"></a>C930</td>
<td class="instruction">JR NZ,$C943</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c932"></a>C932</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c933"></a>C933</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c934"></a>C934</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">POP DEdash // ie. DEdash = HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c935"></a>C935</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="3">DEdash += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c936"></a>C936</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c937"></a>C937</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c938"></a>C938</td>
<td class="instruction">LD HL,$81B8</td>
<td class="comment-11" rowspan="1">HLdash = &amp;hero_map_position.y;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c93b"></a>C93B</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DEdash++ = *HLdash++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c93d"></a>C93D</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DEdash++ = *HLdash++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c93f"></a>C93F</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c940"></a>C940</td>
<td class="instruction">JP $C9C0</td>
<td class="comment-11" rowspan="1">goto jump_c9c0; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c943"></a>C943</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="2">else if (A == vischar_FLAGS_BIT1) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c945"></a>C945</td>
<td class="instruction">JR NZ,$C953</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c947"></a>C947</td>
<td class="instruction">LD A,($A139)</td>
<td class="comment-11" rowspan="3">if (automatic_player_counter) goto $C932; // jump into case 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c94a"></a>C94A</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c94b"></a>C94B</td>
<td class="instruction">JR NZ,$C932</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c94d"></a>C94D</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-11" rowspan="2">*HL++ = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c94f"></a>C94F</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c950"></a>C950</td>
<td class="instruction">JP <a class="link" href="CB23.html">$CB23</a></td>
<td class="comment-11" rowspan="1">sub_CB23(); return; %&gt; // exit via</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c953"></a>C953</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="2">else if (A == (vischar_FLAGS_BRIBE_PENDING + vischar_FLAGS_BIT1)) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c955"></a>C955</td>
<td class="instruction">JR NZ,$C979</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c957"></a>C957</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c958"></a>C958</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c959"></a>C959</td>
<td class="instruction">LD HL,$76FA</td>
<td class="comment-11" rowspan="3">if (item_structs[item_FOOD].room &amp; itemstruct_ROOM_FLAG_NEARBY_7) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c95c"></a>C95C</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c95e"></a>C95E</td>
<td class="instruction">JR Z,$C96C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c960"></a>
<div class="comments">
<div class="paragraph">
Moves dog toward poisoned food?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c960"></a>C960</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c961"></a>C961</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="3">DE += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c962"></a>C962</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c964"></a>C964</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c965"></a>C965</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c967"></a>C967</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c969"></a>C969</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c96a"></a>C96A</td>
<td class="instruction">JR $C9C0</td>
<td class="comment-11" rowspan="1">goto jump_c9c0; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c96c"></a>C96C</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">else &lt;% A = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c96d"></a>C96D</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">*DE = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c96e"></a>C96E</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c96f"></a>C96F</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">*++HL = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c970"></a>C970</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c972"></a>C972</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">*++HL = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c973"></a>C973</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c975"></a>C975</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c976"></a>C976</td>
<td class="instruction">JP <a class="link" href="CB23.html">$CB23</a></td>
<td class="comment-11" rowspan="1">sub_CB23(); return; %&gt; %&gt; // exit via</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c979"></a>C979</td>
<td class="instruction">CP $04</td>
<td class="comment-11" rowspan="2">else if (A == vischar_FLAGS_SAW_BRIBE) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c97b"></a>C97B</td>
<td class="instruction">JR NZ,$C9BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c97d"></a>C97D</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c97e"></a>C97E</td>
<td class="instruction">LD A,($AF8E)</td>
<td class="comment-11" rowspan="1">A = bribed_character;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c981"></a>C981</td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="2">if (A != character_NONE) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c983"></a>C983</td>
<td class="instruction">JR Z,$C995</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c985"></a>C985</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c986"></a>C986</td>
<td class="instruction">LD B,$07</td>
<td class="comment-11" rowspan="1">B = 7; // 7 iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c988"></a>C988</td>
<td class="instruction">LD HL,$8020</td>
<td class="comment-11" rowspan="1">HL = $8020; // iterate over non-player characters</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c98b"></a>C98B</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1">do &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c98c"></a>C98C</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="2">if (*HL == A) goto found_bribed;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c98d"></a>C98D</td>
<td class="instruction">JR Z,$C99C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c98f"></a>C98F</td>
<td class="instruction">LD A,$20</td>
<td class="comment-11" rowspan="3">HL += 32;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c991"></a>C991</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c992"></a>C992</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c993"></a>C993</td>
<td class="instruction">DJNZ $C98B</td>
<td class="comment-11" rowspan="1">%&gt; while (--B); %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c995"></a>C995</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c996"></a>
<div class="comments">
<div class="paragraph">
Bribed character was not visible.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c996"></a>C996</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-11" rowspan="2">*HL++ = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c998"></a>C998</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c999"></a>C999</td>
<td class="instruction">JP <a class="link" href="CB23.html">$CB23</a></td>
<td class="comment-11" rowspan="1">sub_CB23(); return; // exit via</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c99c"></a>
<div class="comments">
<div class="paragraph">
Found bribed character.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c99c"></a>C99C</td>
<td class="instruction">LD A,$0F</td>
<td class="comment-11" rowspan="3">found_bribed: HL += 15;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c99e"></a>C99E</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c99f"></a>C99F</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a0"></a>C9A0</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">POP DE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a1"></a>C9A1</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">PUSH DE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a2"></a>C9A2</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="3">DE += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a3"></a>C9A3</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a5"></a>C9A5</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a6"></a>C9A6</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9a9"></a>C9A9</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9aa"></a>C9AA</td>
<td class="instruction">JP NZ,$C9B2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c9ad"></a>
<div class="comments">
<div class="paragraph">
Indoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9ad"></a>C9AD</td>
<td class="instruction">CALL <a class="link" href="E542.html">$E542</a></td>
<td class="comment-11" rowspan="1">pos_to_tinypos(HL,DE); %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9b0"></a>C9B0</td>
<td class="instruction">JR $C9B7</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c9b2"></a>
<div class="comments">
<div class="paragraph">
Outdoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9b2"></a>C9B2</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9b4"></a>C9B4</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9b5"></a>C9B5</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9b7"></a>C9B7</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9b8"></a>C9B8</td>
<td class="instruction">JR $C9C0</td>
<td class="comment-11" rowspan="1">goto jump_c9c0; %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9ba"></a>C9BA</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="3">A = HL[1];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9bb"></a>C9BB</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9bc"></a>C9BC</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9bd"></a>C9BD</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A == 0) goto character_behaviour_end_1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9be"></a>C9BE</td>
<td class="instruction">JR Z,$C9F5</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9c0"></a>C9C0</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">jump_c9c0: A = *HL; // HL is $8001</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9c1"></a>C9C1</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9c2"></a>C9C2</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Cdash = A;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c9c3"></a>
<div class="comments">
<div class="paragraph">
Self modify move_character_x/y routines.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9c3"></a>C9C3</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index &gt; room_0_OUTDOORS) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9c6"></a>C9C6</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9c7"></a>C9C7</td>
<td class="instruction">JR Z,$C9CE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9c9"></a>C9C9</td>
<td class="instruction">LD HL,$CB75</td>
<td class="comment-11" rowspan="1">HLdash = &amp;multiply_by_1; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9cc"></a>C9CC</td>
<td class="instruction">JR $C9DA</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9ce"></a>C9CE</td>
<td class="instruction">BIT 6,C</td>
<td class="comment-11" rowspan="2">if (Cdash &amp; vischar_FLAGS_BIT6) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9d0"></a>C9D0</td>
<td class="instruction">JR Z,$C9D7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9d2"></a>C9D2</td>
<td class="instruction">LD HL,$B295</td>
<td class="comment-11" rowspan="1">HLdash = &amp;multiply_by_4; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9d5"></a>C9D5</td>
<td class="instruction">JR $C9DA</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9d7"></a>C9D7</td>
<td class="instruction">LD HL,$B1C7</td>
<td class="comment-11" rowspan="1">HLdash = &amp;multiply_by_8; %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9da"></a>C9DA</td>
<td class="instruction">LD ($CA13),HL</td>
<td class="comment-11" rowspan="1">($CA13) = HLdash; // self-modify move_character_x:$CA13</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9dd"></a>C9DD</td>
<td class="instruction">LD ($CA4B),HL</td>
<td class="comment-11" rowspan="1">($CA4B) = HLdash; // self-modify move_character_y:$CA4B</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9e0"></a>C9E0</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9e1"></a>C9E1</td>
<td class="instruction">BIT 5,(IY+$07)</td>
<td class="comment-11" rowspan="2">if (IY[7] &amp; vischar_BYTE7_IMPEDED) goto character_behaviour_end_2; // hit a wall etc.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9e5"></a>C9E5</td>
<td class="instruction">JR NZ,$C9FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9e7"></a>C9E7</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="3">HL += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9e8"></a>C9E8</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9e9"></a>C9E9</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9ea"></a>C9EA</td>
<td class="instruction">CALL <a class="link" href="CA11.html">$CA11</a></td>
<td class="comment-11" rowspan="1">move_character_x();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9ed"></a>C9ED</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment-11" rowspan="1">if (Z) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9ef"></a>C9EF</td>
<td class="instruction">CALL <a class="link" href="CA49.html">$CA49</a></td>
<td class="comment-11" rowspan="1">move_character_y();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9f2"></a>C9F2</td>
<td class="instruction">JP Z,<a class="link" href="CA81.html">$CA81</a></td>
<td class="comment-11" rowspan="1">if (Z) goto bribes_solitary_food; %&gt; // exit via // character couldn't move?</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="c9f5"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="CA81.html">CA81</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9f5"></a>C9F5</td>
<td class="instruction">CP (IY+$0D)</td>
<td class="comment-11" rowspan="4">character_behaviour_end_1: if (A != IY[13]) IY[13] = A | input_KICK; // sampled IY=$8040,$8020,$8000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9f8"></a>C9F8</td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9f9"></a>C9F9</td>
<td class="instruction">OR $80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9fb"></a>C9FB</td>
<td class="instruction">LD (IY+$0D),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="c9fe"></a>C9FE</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="c9ff"></a>C9FF</td>
<td class="instruction">LD A,$04</td>
<td class="comment-11" rowspan="3">character_behaviour_end_2: L += 4;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca01"></a>CA01</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca02"></a>CA02</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca03"></a>CA03</td>
<td class="instruction">CALL <a class="link" href="CA49.html">$CA49</a></td>
<td class="comment-11" rowspan="1">move_character_y();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca06"></a>CA06</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment-11" rowspan="2">if (Z) move_character_x();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca08"></a>CA08</td>
<td class="instruction">CALL <a class="link" href="CA11.html">$CA11</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca0b"></a>CA0B</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment-11" rowspan="1">if (!Z) goto character_behaviour_end_1; // likely: couldn't move, so .. do something</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca0d"></a>CA0D</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1">HL--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ca0e"></a>CA0E</td>
<td class="instruction">JP <a class="link" href="CA81.html">$CA81</a></td>
<td class="comment-11" rowspan="1">bribes_solitary_food(); return; // exit via</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="C892.html">C892</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#c918">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="CA11.html">CA11</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20150622</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.4.</div>
</div>
</body>
</html>