<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at DBEB</title>
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="disassembly">
<table class="header">
<tr>
<td class="headerLogo"><a class="link" href="../index.html"><img src="../images/logo.png" alt="The Great Escape" /></a></td>
<td class="headerText">Routines</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="56222.html">DB9E</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#56299">Map</a></td>
<td class="next">Next: <a class="link" href="56385.html">DC41</a></td>
</tr>
</table>
<div class="description">DBEB: sub_DBEB</div>
<table class="disassembly">
<tr>
<td class="routineComment" colspan="3">
<div class="details">
<div class="paragraph">
Iterates over all items. Uses BC_becomes_A_times_8.
</div>
</div>
<table class="output">
<tr>
<td class="register">IY</td>
<td class="registerContents">Pointer to ? (result?)</td>
</tr>
<tr>
<td class="register">Adash</td>
<td class="registerContents">result?</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="label"><a name="56299"></a>DBEB</td>
<td class="instruction">LD BC,$1007</td>
<td class="comment">B = 16; // iterations</td>
</tr>
<tr>
<td class="address"><a name="56302"></a>DBEE</td>
<td class="instruction">LD HL,$76C9</td>
<td class="comment">Outer_HL = &amp;item_structs[0].room;</td>
</tr>
<tr>
<td class="label"><a name="56305"></a>DBF1</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment" rowspan="56">do { if ((*Outer_HL &amp; (itemstruct_ROOM_FLAG_BIT6 | itemstruct_ROOM_FLAG_ITEM_NEARBY)) == (itemstruct_ROOM_FLAG_BIT6 | itemstruct_ROOM_FLAG_ITEM_NEARBY)) {} HL = Outer_HL; - {  HLdash = *++HL * 8; // y position } A &amp;= A; // clear carry? HLdash -= BCdash; // where is BCdash initialised? {  if (HLdash &gt; 0) { } HL++; // x position {    HLdash = *HL * 8; } - - // not clearing carry? HLdash -= BCdash; // where is BCdash initialised? {    if (HLdash &gt; 0) { } {      HLdash = HL; } {      DEdash = *HLdash-- * 8; // x position } {      BCdash = *HLdash-- * 8; // y position } {      HLdash--; // point to item } {      IY = HLdash; // IY is not banked } - // fetch iter count - {      A = (16 - B) | (1&lt;&lt;6); } EX AF,AF' } } // unpaired // returns the value in Adash - - {  } Outer_HL += 7; // stride } while (--B);</td>
</tr>
<tr>
<td class="address"><a name="56307"></a>DBF3</td>
<td class="instruction">JR Z,$DC38</td>
</tr>
<tr>
<td class="address"><a name="56309"></a>DBF5</td>
<td class="instruction">BIT 6,(HL)</td>
</tr>
<tr>
<td class="address"><a name="56311"></a>DBF7</td>
<td class="instruction">JR Z,$DC38</td>
</tr>
<tr>
<td class="address"><a name="56313"></a>DBF9</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="56314"></a>DBFA</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address"><a name="56315"></a>DBFB</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="56316"></a>DBFC</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="56317"></a>DBFD</td>
<td class="instruction">CALL <a class="link" href="45511.html">$B1C7</a></td>
</tr>
<tr>
<td class="address"><a name="56320"></a>DC00</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address"><a name="56321"></a>DC01</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="56322"></a>DC02</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="56323"></a>DC03</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address"><a name="56324"></a>DC04</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="address"><a name="56326"></a>DC06</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="56327"></a>DC07</td>
<td class="instruction">JR Z,$DC36</td>
</tr>
<tr>
<td class="address"><a name="56329"></a>DC09</td>
<td class="instruction">JR C,$DC36</td>
</tr>
<tr>
<td class="address"><a name="56331"></a>DC0B</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="56332"></a>DC0C</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="56333"></a>DC0D</td>
<td class="instruction">CALL <a class="link" href="45511.html">$B1C7</a></td>
</tr>
<tr>
<td class="address"><a name="56336"></a>DC10</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address"><a name="56337"></a>DC11</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="56338"></a>DC12</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="56339"></a>DC13</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="address"><a name="56341"></a>DC15</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="56342"></a>DC16</td>
<td class="instruction">JR Z,$DC36</td>
</tr>
<tr>
<td class="address"><a name="56344"></a>DC18</td>
<td class="instruction">JR C,$DC36</td>
</tr>
<tr>
<td class="address"><a name="56346"></a>DC1A</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="56347"></a>DC1B</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="56348"></a>DC1C</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="56349"></a>DC1D</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="56350"></a>DC1E</td>
<td class="instruction">CALL <a class="link" href="45511.html">$B1C7</a></td>
</tr>
<tr>
<td class="address"><a name="56353"></a>DC21</td>
<td class="instruction">LD E,C</td>
</tr>
<tr>
<td class="address"><a name="56354"></a>DC22</td>
<td class="instruction">LD D,B</td>
</tr>
<tr>
<td class="address"><a name="56355"></a>DC23</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address"><a name="56356"></a>DC24</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="56357"></a>DC25</td>
<td class="instruction">CALL <a class="link" href="45511.html">$B1C7</a></td>
</tr>
<tr>
<td class="address"><a name="56360"></a>DC28</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address"><a name="56361"></a>DC29</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address"><a name="56362"></a>DC2A</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="56363"></a>DC2B</td>
<td class="instruction">POP IY</td>
</tr>
<tr>
<td class="address"><a name="56365"></a>DC2D</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="56366"></a>DC2E</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="address"><a name="56367"></a>DC2F</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address"><a name="56368"></a>DC30</td>
<td class="instruction">LD A,$10</td>
</tr>
<tr>
<td class="address"><a name="56370"></a>DC32</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address"><a name="56371"></a>DC33</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address"><a name="56373"></a>DC35</td>
<td class="instruction">EX AF,AF'</td>
</tr>
<tr>
<td class="label"><a name="56374"></a>DC36</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="address"><a name="56375"></a>DC37</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="label"><a name="56376"></a>DC38</td>
<td class="instruction">LD A,C</td>
</tr>
<tr>
<td class="address"><a name="56377"></a>DC39</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="address"><a name="56378"></a>DC3A</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address"><a name="56379"></a>DC3B</td>
<td class="instruction">JR NC,$DC3E</td>
</tr>
<tr>
<td class="address"><a name="56381"></a>DC3D</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="label"><a name="56382"></a>DC3E</td>
<td class="instruction">DJNZ $DBF1</td>
</tr>
<tr>
<td class="address"><a name="56384"></a>DC40</td>
<td class="instruction">RET</td>
<td class="comment">return;</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="56222.html">DB9E</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#56299">Map</a></td>
<td class="next">Next: <a class="link" href="56385.html">DC41</a></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20130626</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 3.3.2.</div>
</div>
</body>
</html>