<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at C918</title>
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="disassembly">
<table class="header">
<tr>
<td class="headerLogo"><a class="link" href="../index.html"><img src="../images/logo.png" alt="The Great Escape" /></a></td>
<td class="headerText">Routines</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="51346.html">C892</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#51480">Map</a></td>
<td class="next">Next: <a class="link" href="51729.html">CA11</a></td>
</tr>
</table>
<div class="description">C918: sub_C918</div>
<table class="disassembly">
<tr>
<td class="routineComment" colspan="3">
<div class="details">
<div class="paragraph">
...
</div>
</div>
</td>
</tr>
<tr>
<td class="label"><a name="51480"></a>C918</td>
<td class="instruction">LD A,(IY+$07)</td>
<td class="comment">A = IY[7];</td>
</tr>
<tr>
<td class="address"><a name="51483"></a>C91B</td>
<td class="instruction">LD B,A</td>
<td class="comment">B = A;</td>
</tr>
<tr>
<td class="address"><a name="51484"></a>C91C</td>
<td class="instruction">AND $0F</td>
<td class="comment">A &amp;= 0x0F;</td>
</tr>
<tr>
<td class="address"><a name="51486"></a>C91E</td>
<td class="instruction">JR Z,$C925</td>
<td class="comment">if (A) {</td>
</tr>
<tr>
<td class="address"><a name="51488"></a>C920</td>
<td class="instruction">DEC B</td>
<td class="comment" rowspan="2">IY[7] = --B;</td>
</tr>
<tr>
<td class="address"><a name="51489"></a>C921</td>
<td class="instruction">LD (IY+$07),B</td>
</tr>
<tr>
<td class="address"><a name="51492"></a>C924</td>
<td class="instruction">RET</td>
<td class="comment">return; }</td>
</tr>
<tr>
<td class="label"><a name="51493"></a>C925</td>
<td class="instruction">PUSH IY</td>
<td class="comment" rowspan="2">HL = IY;</td>
</tr>
<tr>
<td class="address"><a name="51495"></a>C927</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="51496"></a>C928</td>
<td class="instruction">INC L</td>
<td class="comment" rowspan="2">A = *++HL;</td>
</tr>
<tr>
<td class="address"><a name="51497"></a>C929</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="51498"></a>C92A</td>
<td class="instruction">AND A</td>
<td class="comment" rowspan="2">if (A == 0) goto $C9BA;</td>
</tr>
<tr>
<td class="address"><a name="51499"></a>C92B</td>
<td class="instruction">JP Z,$C9BA</td>
</tr>
<tr>
<td class="address"><a name="51502"></a>C92E</td>
<td class="instruction">CP $01</td>
<td class="comment" rowspan="13">if (A == 1) } PUSH HL EXX POP DE {DE += 3; } HL = 0x81B8; // player_map_position_perhapsX *DE++ = *HL++; *DE++ = *HL++; EXX JP $C9C0</td>
</tr>
<tr>
<td class="address"><a name="51504"></a>C930</td>
<td class="instruction">JR NZ,$C943</td>
</tr>
<tr>
<td class="label"><a name="51506"></a>C932</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="51507"></a>C933</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="51508"></a>C934</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="address"><a name="51509"></a>C935</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address"><a name="51510"></a>C936</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address"><a name="51511"></a>C937</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address"><a name="51512"></a>C938</td>
<td class="instruction">LD HL,$81B8</td>
</tr>
<tr>
<td class="address"><a name="51515"></a>C93B</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="address"><a name="51517"></a>C93D</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="address"><a name="51519"></a>C93F</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="address"><a name="51520"></a>C940</td>
<td class="instruction">JP $C9C0</td>
</tr>
<tr>
<td class="label"><a name="51523"></a>C943</td>
<td class="instruction">CP $02</td>
<td class="comment" rowspan="8">if (A == 2) } A = morale_related_also; {if (A) goto $C932; } {*HL++ = 0; } JP $CB23</td>
</tr>
<tr>
<td class="address"><a name="51525"></a>C945</td>
<td class="instruction">JR NZ,$C953</td>
</tr>
<tr>
<td class="address"><a name="51527"></a>C947</td>
<td class="instruction">LD A,($A139)</td>
</tr>
<tr>
<td class="address"><a name="51530"></a>C94A</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address"><a name="51531"></a>C94B</td>
<td class="instruction">JR NZ,$C932</td>
</tr>
<tr>
<td class="address"><a name="51533"></a>C94D</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="address"><a name="51535"></a>C94F</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51536"></a>C950</td>
<td class="instruction">JP <a class="link" href="51841.html#52003">$CB23</a></td>
</tr>
<tr>
<td class="label"><a name="51539"></a>C953</td>
<td class="instruction">CP $03</td>
<td class="comment" rowspan="24">if (A == 3) } PUSH HL EX DE,HL {if (itemstruct_7.room &amp; (1&lt;&lt;7)) { } HL++; {DE += 3; } *DE++ = *HL++; *DE++ = *HL++; POP HL goto $C9C0 } else {; A = 0; *DE = A; EX DE,HL {*++HL = 0xFF; } {*++HL = 0; } POP HL JP $CB23 }</td>
</tr>
<tr>
<td class="address"><a name="51541"></a>C955</td>
<td class="instruction">JR NZ,$C979</td>
</tr>
<tr>
<td class="address"><a name="51543"></a>C957</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="51544"></a>C958</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address"><a name="51545"></a>C959</td>
<td class="instruction">LD HL,$76FA</td>
</tr>
<tr>
<td class="address"><a name="51548"></a>C95C</td>
<td class="instruction">BIT 7,(HL)</td>
</tr>
<tr>
<td class="address"><a name="51550"></a>C95E</td>
<td class="instruction">JR Z,$C96C</td>
</tr>
<tr>
<td class="address"><a name="51552"></a>C960</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address"><a name="51553"></a>C961</td>
<td class="instruction">LD A,E</td>
</tr>
<tr>
<td class="address"><a name="51554"></a>C962</td>
<td class="instruction">ADD A,$03</td>
</tr>
<tr>
<td class="address"><a name="51556"></a>C964</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address"><a name="51557"></a>C965</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="address"><a name="51559"></a>C967</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="address"><a name="51561"></a>C969</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="51562"></a>C96A</td>
<td class="instruction">JR $C9C0</td>
</tr>
<tr>
<td class="label"><a name="51564"></a>C96C</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address"><a name="51565"></a>C96D</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address"><a name="51566"></a>C96E</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address"><a name="51567"></a>C96F</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51568"></a>C970</td>
<td class="instruction">LD (HL),$FF</td>
</tr>
<tr>
<td class="address"><a name="51570"></a>C972</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51571"></a>C973</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="address"><a name="51573"></a>C975</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="51574"></a>C976</td>
<td class="instruction">JP <a class="link" href="51841.html#52003">$CB23</a></td>
</tr>
<tr>
<td class="label"><a name="51577"></a>C979</td>
<td class="instruction">CP $04</td>
<td class="comment" rowspan="38">if (A == 4) } PUSH HL A = bribed_character; {if (A != 0xFF) { } C = A; B = 7; // 7 iterations HL = $8020; do { A = C; CP *HL JR Z,$C99C {HL += 32; } } while (--B); } POP HL {*HL++ = 0; } JP $CB23 {HL += 15; } POP DE PUSH DE {DE += 3; } A = indoor_room_index; // might fold down {if (A) { } divide_3xAC_by_8_with_rounding(); } else { *DE++ = *HL++; HL++; *DE++ = *HL++; } POP HL goto $C9C0 };</td>
</tr>
<tr>
<td class="address"><a name="51579"></a>C97B</td>
<td class="instruction">JR NZ,$C9BA</td>
</tr>
<tr>
<td class="address"><a name="51581"></a>C97D</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address"><a name="51582"></a>C97E</td>
<td class="instruction">LD A,($AF8E)</td>
</tr>
<tr>
<td class="address"><a name="51585"></a>C981</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address"><a name="51587"></a>C983</td>
<td class="instruction">JR Z,$C995</td>
</tr>
<tr>
<td class="address"><a name="51589"></a>C985</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address"><a name="51590"></a>C986</td>
<td class="instruction">LD B,$07</td>
</tr>
<tr>
<td class="address"><a name="51592"></a>C988</td>
<td class="instruction">LD HL,$8020</td>
</tr>
<tr>
<td class="label"><a name="51595"></a>C98B</td>
<td class="instruction">LD A,C</td>
</tr>
<tr>
<td class="address"><a name="51596"></a>C98C</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="address"><a name="51597"></a>C98D</td>
<td class="instruction">JR Z,$C99C</td>
</tr>
<tr>
<td class="address"><a name="51599"></a>C98F</td>
<td class="instruction">LD A,$20</td>
</tr>
<tr>
<td class="address"><a name="51601"></a>C991</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="address"><a name="51602"></a>C992</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address"><a name="51603"></a>C993</td>
<td class="instruction">DJNZ $C98B</td>
</tr>
<tr>
<td class="label"><a name="51605"></a>C995</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="51606"></a>C996</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="address"><a name="51608"></a>C998</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51609"></a>C999</td>
<td class="instruction">JP <a class="link" href="51841.html#52003">$CB23</a></td>
</tr>
<tr>
<td class="label"><a name="51612"></a>C99C</td>
<td class="instruction">LD A,$0F</td>
</tr>
<tr>
<td class="address"><a name="51614"></a>C99E</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="address"><a name="51615"></a>C99F</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address"><a name="51616"></a>C9A0</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="address"><a name="51617"></a>C9A1</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="address"><a name="51618"></a>C9A2</td>
<td class="instruction">LD A,E</td>
</tr>
<tr>
<td class="address"><a name="51619"></a>C9A3</td>
<td class="instruction">ADD A,$03</td>
</tr>
<tr>
<td class="address"><a name="51621"></a>C9A5</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address"><a name="51622"></a>C9A6</td>
<td class="instruction">LD A,($68A0)</td>
</tr>
<tr>
<td class="address"><a name="51625"></a>C9A9</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address"><a name="51626"></a>C9AA</td>
<td class="instruction">JP NZ,$C9B2</td>
</tr>
<tr>
<td class="address"><a name="51629"></a>C9AD</td>
<td class="instruction">CALL <a class="link" href="58690.html">$E542</a></td>
</tr>
<tr>
<td class="address"><a name="51632"></a>C9B0</td>
<td class="instruction">JR $C9B7</td>
</tr>
<tr>
<td class="label"><a name="51634"></a>C9B2</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="address"><a name="51636"></a>C9B4</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51637"></a>C9B5</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="label"><a name="51639"></a>C9B7</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address"><a name="51640"></a>C9B8</td>
<td class="instruction">JR $C9C0</td>
</tr>
<tr>
<td class="label"><a name="51642"></a>C9BA</td>
<td class="instruction">INC L</td>
<td class="comment" rowspan="2">A = *++HL;</td>
</tr>
<tr>
<td class="address"><a name="51643"></a>C9BB</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address"><a name="51644"></a>C9BC</td>
<td class="instruction">DEC L</td>
<td class="comment">HL--;</td>
</tr>
<tr>
<td class="address"><a name="51645"></a>C9BD</td>
<td class="instruction">AND A</td>
<td class="comment" rowspan="2">if (A == 0) goto sub_C918::$C9F5;</td>
</tr>
<tr>
<td class="address"><a name="51646"></a>C9BE</td>
<td class="instruction">JR Z,$C9F5</td>
</tr>
<tr>
<td class="label"><a name="51648"></a>C9C0</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment">A = *HL;</td>
</tr>
<tr>
<td class="address"><a name="51649"></a>C9C1</td>
<td class="instruction">EXX</td>
<td class="comment">EXX</td>
</tr>
<tr>
<td class="address"><a name="51650"></a>C9C2</td>
<td class="instruction">LD C,A</td>
<td class="comment">C = A;</td>
</tr>
<tr>
<td class="address"><a name="51651"></a>C9C3</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment">A = indoor_room_index;</td>
</tr>
<tr>
<td class="address"><a name="51654"></a>C9C6</td>
<td class="instruction">AND A</td>
<td class="comment" rowspan="9">if (A) } HL = &amp;A_widened_to_BC; } else { {if (C &amp; (1&lt;&lt;6)) { } HL = &amp;BC_becomes_A_times_4; } else { HL = &amp;BC_becomes_A_times_8; }</td>
</tr>
<tr>
<td class="address"><a name="51655"></a>C9C7</td>
<td class="instruction">JR Z,$C9CE</td>
</tr>
<tr>
<td class="address"><a name="51657"></a>C9C9</td>
<td class="instruction">LD HL,$CB75</td>
</tr>
<tr>
<td class="address"><a name="51660"></a>C9CC</td>
<td class="instruction">JR $C9DA</td>
</tr>
<tr>
<td class="label"><a name="51662"></a>C9CE</td>
<td class="instruction">BIT 6,C</td>
</tr>
<tr>
<td class="address"><a name="51664"></a>C9D0</td>
<td class="instruction">JR Z,$C9D7</td>
</tr>
<tr>
<td class="address"><a name="51666"></a>C9D2</td>
<td class="instruction">LD HL,$B295</td>
</tr>
<tr>
<td class="address"><a name="51669"></a>C9D5</td>
<td class="instruction">JR $C9DA</td>
</tr>
<tr>
<td class="label"><a name="51671"></a>C9D7</td>
<td class="instruction">LD HL,$B1C7</td>
</tr>
<tr>
<td class="label"><a name="51674"></a>C9DA</td>
<td class="instruction">LD ($CA13),HL</td>
<td class="comment">($CA13) = HL; // self-modify sub_CA11::CA13</td>
</tr>
<tr>
<td class="address"><a name="51677"></a>C9DD</td>
<td class="instruction">LD ($CA4B),HL</td>
<td class="comment">($CA4B) = HL; // self-modify sub_CA11::CA4B</td>
</tr>
<tr>
<td class="address"><a name="51680"></a>C9E0</td>
<td class="instruction">EXX</td>
<td class="comment">EXX</td>
</tr>
<tr>
<td class="address"><a name="51681"></a>C9E1</td>
<td class="instruction">BIT 5,(IY+$07)</td>
<td class="comment" rowspan="2">if (IY[7] &amp; (1&lt;&lt;5)) goto $C9FF;</td>
</tr>
<tr>
<td class="address"><a name="51685"></a>C9E5</td>
<td class="instruction">JR NZ,$C9FF</td>
</tr>
<tr>
<td class="address"><a name="51687"></a>C9E7</td>
<td class="instruction">INC L</td>
<td class="comment" rowspan="3">HL += 3;</td>
</tr>
<tr>
<td class="address"><a name="51688"></a>C9E8</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51689"></a>C9E9</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address"><a name="51690"></a>C9EA</td>
<td class="instruction">CALL <a class="link" href="51729.html">$CA11</a></td>
<td class="comment">sub_CA11();</td>
</tr>
<tr>
<td class="address"><a name="51693"></a>C9ED</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment">JR NZ,$C9F5</td>
</tr>
<tr>
<td class="address"><a name="51695"></a>C9EF</td>
<td class="instruction">CALL <a class="link" href="51785.html">$CA49</a></td>
<td class="comment">sub_CA49();</td>
</tr>
<tr>
<td class="address"><a name="51698"></a>C9F2</td>
<td class="instruction">JP Z,<a class="link" href="51841.html">$CA81</a></td>
<td class="comment">JP Z,$CA81</td>
</tr>
<tr>
<td class="routineComment" colspan="3">
<a name="51701"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="51841.html">CA81</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="label">C9F5</td>
<td class="instruction">CP (IY+$0D)</td>
<td class="comment">if (IY[13] == 0)</td>
</tr>
<tr>
<td class="address"><a name="51704"></a>C9F8</td>
<td class="instruction">RET Z</td>
<td class="comment">return;</td>
</tr>
<tr>
<td class="address"><a name="51705"></a>C9F9</td>
<td class="instruction">OR $80</td>
<td class="comment" rowspan="2">IY[13] = A | 0x80;</td>
</tr>
<tr>
<td class="address"><a name="51707"></a>C9FB</td>
<td class="instruction">LD (IY+$0D),A</td>
</tr>
<tr>
<td class="address"><a name="51710"></a>C9FE</td>
<td class="instruction">RET</td>
<td class="comment">return;</td>
</tr>
<tr>
<td class="label"><a name="51711"></a>C9FF</td>
<td class="instruction">LD A,$04</td>
<td class="comment" rowspan="3">L += 4;</td>
</tr>
<tr>
<td class="address"><a name="51713"></a>CA01</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="address"><a name="51714"></a>CA02</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address"><a name="51715"></a>CA03</td>
<td class="instruction">CALL <a class="link" href="51785.html">$CA49</a></td>
<td class="comment">sub_CA49();</td>
</tr>
<tr>
<td class="address"><a name="51718"></a>CA06</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment">JR NZ,$C9F5</td>
</tr>
<tr>
<td class="address"><a name="51720"></a>CA08</td>
<td class="instruction">CALL <a class="link" href="51729.html">$CA11</a></td>
<td class="comment">sub_CA11();</td>
</tr>
<tr>
<td class="address"><a name="51723"></a>CA0B</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment">JR NZ,$C9F5</td>
</tr>
<tr>
<td class="address"><a name="51725"></a>CA0D</td>
<td class="instruction">DEC L</td>
<td class="comment">HL--;</td>
</tr>
<tr>
<td class="address"><a name="51726"></a>CA0E</td>
<td class="instruction">JP <a class="link" href="51841.html">$CA81</a></td>
<td class="comment">sub_CA91(); return; // exit via</td>
</tr>
</table>
<table class="prevNext">
<tr>
<td class="prev">Prev: <a class="link" href="51346.html">C892</a></td>
<td class="up">Up: <a class="link" href="../maps/all.html#51480">Map</a></td>
<td class="next">Next: <a class="link" href="51729.html">CA11</a></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20130101</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 3.3.</div>
</div>
</body>
</html>