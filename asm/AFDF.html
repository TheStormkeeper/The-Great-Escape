<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at AFDF</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="AF8F.html">AF8F</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#afdf">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="B107.html">B107</a></span></td>
</tr>
</table>
<div class="description">AFDF: (unknown) Definitely something to do with moving objects around. Collisions?</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="AF8F.html">AF8F</a> and <a class="link" href="C4E0.html">C4E0</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="afdf"></a>AFDF</td>
<td class="instruction">LD HL,$8001</td>
<td class="comment-11" rowspan="1">HL = $8001; // &amp;vischar[0].byte1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afe2"></a>AFE2</td>
<td class="instruction">LD B,$08</td>
<td class="comment-11" rowspan="1">B = 8; // 8 iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="afe4"></a>AFE4</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="2">do &lt;% if (*HL &amp; vischar_FLAGS_NO_COLLIDE) goto next; // $8001, $8021, ...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afe6"></a>AFE6</td>
<td class="instruction">JP NZ,$B0FE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afe9"></a>AFE9</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">PUSH BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afea"></a>AFEA</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afeb"></a>AFEB</td>
<td class="instruction">LD A,$0E</td>
<td class="comment-11" rowspan="3">HL += 0x0E; // $800F etc. - X axis position</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afed"></a>AFED</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afee"></a>AFEE</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="afef"></a>
<div class="comments">
<div class="paragraph">
--------
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="afef"></a>AFEF</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-11" rowspan="2">C = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff0"></a>AFF0</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff1"></a>AFF1</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1">B = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff2"></a>AFF2</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff3"></a>AFF3</td>
<td class="instruction">LD HL,($81A4)</td>
<td class="comment-11" rowspan="1">HL = saved_pos_x;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff6"></a>AFF6</td>
<td class="instruction">LD A,$04</td>
<td class="comment-11" rowspan="6">BC += 4;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff8"></a>AFF8</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="aff9"></a>AFF9</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="affa"></a>AFFA</td>
<td class="instruction">JR NC,$AFFE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="affc"></a>AFFC</td>
<td class="instruction">INC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="affd"></a>AFFD</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="affe"></a>AFFE</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="2">if (HL != BC) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b000"></a>B000</td>
<td class="instruction">JR Z,$B014</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b002"></a>B002</td>
<td class="instruction">JP NC,$B0FC</td>
<td class="comment-11" rowspan="1">if (HL &gt; BC) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b005"></a>B005</td>
<td class="instruction">SUB $08</td>
<td class="comment-11" rowspan="5">BC -= 8; // ie -4 over original</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b007"></a>B007</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b008"></a>B008</td>
<td class="instruction">JR NC,$B00C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b00a"></a>B00A</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b00b"></a>B00B</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b00c"></a>B00C</td>
<td class="instruction">LD HL,($81A4)</td>
<td class="comment-11" rowspan="2">HL = saved_pos_x;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b00f"></a>B00F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b011"></a>B011</td>
<td class="instruction">JP C,$B0FC</td>
<td class="comment-11" rowspan="1">if (HL &lt; BC) goto pop_next; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b014"></a>B014</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b015"></a>B015</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b016"></a>
<div class="comments">
<div class="paragraph">
--------
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b016"></a>B016</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-11" rowspan="2">C = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b017"></a>B017</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b018"></a>B018</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1">B = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b019"></a>B019</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b01a"></a>B01A</td>
<td class="instruction">LD HL,($81A6)</td>
<td class="comment-11" rowspan="1">HL = saved_pos_y;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b01d"></a>B01D</td>
<td class="instruction">LD A,$04</td>
<td class="comment-11" rowspan="6">BC += 4;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b01f"></a>B01F</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b020"></a>B020</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b021"></a>B021</td>
<td class="instruction">JR NC,$B025</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b023"></a>B023</td>
<td class="instruction">INC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b024"></a>B024</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b025"></a>B025</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="2">if (HL != BC) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b027"></a>B027</td>
<td class="instruction">JR Z,$B03B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b029"></a>B029</td>
<td class="instruction">JP NC,$B0FC</td>
<td class="comment-11" rowspan="1">if (HL &gt; BC) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b02c"></a>B02C</td>
<td class="instruction">SUB $08</td>
<td class="comment-11" rowspan="5">BC -= 8;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b02e"></a>B02E</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b02f"></a>B02F</td>
<td class="instruction">JR NC,$B033</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b031"></a>B031</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b032"></a>B032</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b033"></a>B033</td>
<td class="instruction">LD HL,($81A6)</td>
<td class="comment-11" rowspan="2">HL = saved_pos_y;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b036"></a>B036</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b038"></a>B038</td>
<td class="instruction">JP C,$B0FC</td>
<td class="comment-11" rowspan="1">if (HL &lt; BC) goto pop_next; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b03b"></a>B03B</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b03c"></a>B03C</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b03d"></a>
<div class="comments">
<div class="paragraph">
--------
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b03d"></a>B03D</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-11" rowspan="1">C = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b03e"></a>B03E</td>
<td class="instruction">LD A,($81A8)</td>
<td class="comment-11" rowspan="2">A = saved_height - C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b041"></a>B041</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b042"></a>B042</td>
<td class="instruction">JR NC,$B046</td>
<td class="comment-11" rowspan="1">if (A &lt; 0) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b044"></a>B044</td>
<td class="instruction">NEG</td>
<td class="comment-11" rowspan="1">A = -A; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b046"></a>B046</td>
<td class="instruction">CP $18</td>
<td class="comment-11" rowspan="2">if (A &gt;= 24) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b048"></a>B048</td>
<td class="instruction">JP NC,$B0FC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b04b"></a>
<div class="comments">
<div class="paragraph">
If specified vischar character has a bribe pending...
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b04b"></a>B04B</td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-11" rowspan="2">A = IY[1] &amp; 0x0F; // sampled IY=$8020, $8040, $8060, $8000 // but this is *not* vischar_FLAGS_MASK, which is 0x1F</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b04e"></a>B04E</td>
<td class="instruction">AND $0F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b050"></a>B050</td>
<td class="instruction">CP $01</td>
<td class="comment-11" rowspan="2">if (A == 1) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b052"></a>B052</td>
<td class="instruction">JR NZ,$B071</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b054"></a>
<div class="comments">
<div class="paragraph">
and current vischar is not the hero...
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b054"></a>B054</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b055"></a>B055</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL // sampled HL=$8021, $8041, $8061, $80A1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b056"></a>B056</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1">HL--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b057"></a>B057</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="3">if ((HL &amp; 0xFF) == 0) &lt;% // ie. $8000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b058"></a>B058</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b059"></a>B059</td>
<td class="instruction">JR NZ,$B071</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b05b"></a>B05B</td>
<td class="instruction">LD A,($AF8E)</td>
<td class="comment-11" rowspan="3">if (bribed_character == IY[0]) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b05e"></a>B05E</td>
<td class="instruction">CP (IY+$00)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b061"></a>B061</td>
<td class="instruction">JR NZ,$B068</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b063"></a>B063</td>
<td class="instruction">CALL <a class="link" href="B107.html">$B107</a></td>
<td class="comment-11" rowspan="1">accept_bribe(); %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b066"></a>B066</td>
<td class="instruction">JR $B071</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b068"></a>
<div class="comments">
<div class="paragraph">
A hostile catches the hero!
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b068"></a>B068</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b069"></a>B069</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">POP BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b06a"></a>B06A</td>
<td class="instruction">PUSH IY</td>
<td class="comment-11" rowspan="3">HL = IY + 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b06c"></a>B06C</td>
<td class="instruction">POP HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b06d"></a>B06D</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b06e"></a>B06E</td>
<td class="instruction">JP <a class="link" href="CB98.html">$CB98</a></td>
<td class="comment-11" rowspan="1">solitary(); return; // exit via %&gt; %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b071"></a>B071</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b072"></a>B072</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1">HL--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b073"></a>B073</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL; // sampled HL = $80C0, $8040, $8000, $8020, $8060 // vischar_BYTE0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b074"></a>B074</td>
<td class="instruction">CP $1A</td>
<td class="comment-11" rowspan="2">if (A &gt;= 26) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b076"></a>B076</td>
<td class="instruction">JR C,$B0B9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b078"></a>B078</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b079"></a>B079</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b07a"></a>B07A</td>
<td class="instruction">LD A,$11</td>
<td class="comment-11" rowspan="3">HL += 17;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b07c"></a>B07C</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b07d"></a>B07D</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b07e"></a>B07E</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b07f"></a>B07F</td>
<td class="instruction">LD BC,$0723</td>
<td class="comment-11" rowspan="1">B = 7; C = 35;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b082"></a>B082</td>
<td class="instruction">CP $1C</td>
<td class="comment-11" rowspan="1">tmpA = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b084"></a>B084</td>
<td class="instruction">LD A,(IY+$0E)</td>
<td class="comment-11" rowspan="1">A = IY[14]; // interleaved</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b087"></a>B087</td>
<td class="instruction">JR NZ,$B08F</td>
<td class="comment-11" rowspan="1">if (tmpA == 28) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b089"></a>B089</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">L -= 2;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b08a"></a>B08A</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b08b"></a>B08B</td>
<td class="instruction">LD C,$36</td>
<td class="comment-11" rowspan="1">C = 54;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b08d"></a>B08D</td>
<td class="instruction">XOR $01</td>
<td class="comment-11" rowspan="1">A ^= 1; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b08f"></a>B08F</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A == 0) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b090"></a>B090</td>
<td class="instruction">JR NZ,$B09D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b092"></a>B092</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b093"></a>B093</td>
<td class="instruction">CP C</td>
<td class="comment-11" rowspan="2">if (A != C) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b094"></a>B094</td>
<td class="instruction">JR Z,$B0B8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b096"></a>B096</td>
<td class="instruction">JR C,$B09A</td>
<td class="comment-11" rowspan="3">if (A &gt;= C) (*HL) -= 2; // decrement by -2 then execute +1 anyway to avoid branch</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b098"></a>B098</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b099"></a>B099</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b09a"></a>B09A</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">(*HL)++; %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b09b"></a>B09B</td>
<td class="instruction">JR $B0B8</td>
<td class="comment-11" rowspan="3">else if (A == 1) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b09d"></a>B09D</td>
<td class="instruction">CP $01</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b09f"></a>B09F</td>
<td class="instruction">JR NZ,$B0A9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0a1"></a>B0A1</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="2">A = C + B;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0a2"></a>B0A2</td>
<td class="instruction">ADD A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0a3"></a>B0A3</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="3">if (A != *HL) (*HL)++; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0a4"></a>B0A4</td>
<td class="instruction">JR Z,$B0B8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0a6"></a>B0A6</td>
<td class="instruction">INC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0a7"></a>B0A7</td>
<td class="instruction">JR $B0B8</td>
<td class="comment-11" rowspan="3">else if (A == 2) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0a9"></a>B0A9</td>
<td class="instruction">CP $02</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ab"></a>B0AB</td>
<td class="instruction">JR NZ,$B0B2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ad"></a>B0AD</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="2">A = C - B;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ae"></a>B0AE</td>
<td class="instruction">SUB B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0af"></a>B0AF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">*HL = A; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0b0"></a>B0B0</td>
<td class="instruction">JR $B0B8</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0b2"></a>B0B2</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="2">A = C - B;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0b3"></a>B0B3</td>
<td class="instruction">SUB B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0b4"></a>B0B4</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="3">if (A != *HL) (*HL)--; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0b5"></a>B0B5</td>
<td class="instruction">JR Z,$B0B8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0b7"></a>B0B7</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0b8"></a>B0B8</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0b9"></a>B0B9</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">POP BC %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ba"></a>B0BA</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="3">HL += 13;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0bb"></a>B0BB</td>
<td class="instruction">ADD A,$0D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0bd"></a>B0BD</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0be"></a>B0BE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">A = *HL &amp; vischar_INPUT_MASK; // mask off kick flag // sampled HL = $806D, $804D, $802D, $808D, $800D</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0bf"></a>B0BF</td>
<td class="instruction">AND $7F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0c1"></a>B0C1</td>
<td class="instruction">JR Z,$B0DB</td>
<td class="comment-11" rowspan="1">if (A) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0c3"></a>B0C3</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0c4"></a>B0C4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">A = *HL ^ 2; // swap direction: top &lt;=&gt; bottom</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0c5"></a>B0C5</td>
<td class="instruction">XOR $02</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0c7"></a>B0C7</td>
<td class="instruction">CP (IY+$0E)</td>
<td class="comment-11" rowspan="2">if (A != IY[14]) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ca"></a>B0CA</td>
<td class="instruction">JR Z,$B0DB</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0cc"></a>B0CC</td>
<td class="instruction">LD (IY+$0D),$80</td>
<td class="comment-11" rowspan="1">IY[13] = input_KICK;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0d0"></a>B0D0</td>
<td class="instruction">LD A,(IY+$07)</td>
<td class="comment-11" rowspan="4">IY[7] = (IY[7] &amp; vischar_BYTE7_MASK_HI) | 5; // preserve flags and set 5? // sampled IY = $8000, $80E0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0d3"></a>B0D3</td>
<td class="instruction">AND $F0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0d5"></a>B0D5</td>
<td class="instruction">OR $05</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0d7"></a>B0D7</td>
<td class="instruction">LD (IY+$07),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0da"></a>B0DA</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">if (!Z) return; /* odd */ %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0db"></a>B0DB</td>
<td class="instruction">LD C,(IY+$0E)</td>
<td class="comment-11" rowspan="2">BC = IY[14]; // sampled IY = $8000, $8040, $80E0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0de"></a>B0DE</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0e0"></a>B0E0</td>
<td class="instruction">LD HL,$B0F8</td>
<td class="comment-11" rowspan="4">IY[13] = collision_new_inputs[BC];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0e3"></a>B0E3</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0e4"></a>B0E4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0e5"></a>B0E5</td>
<td class="instruction">LD (IY+$0D),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0e8"></a>B0E8</td>
<td class="instruction">BIT 0,C</td>
<td class="comment-11" rowspan="2">if ((C &amp; 1) == 0) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ea"></a>B0EA</td>
<td class="instruction">JR NZ,$B0F2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ec"></a>B0EC</td>
<td class="instruction">RES 5,(IY+$07)</td>
<td class="comment-11" rowspan="1">IY[7] &amp;= ~vischar_BYTE7_IMPEDED;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0f0"></a>B0F0</td>
<td class="instruction">JR $B0D0</td>
<td class="comment-11" rowspan="1">goto $B0D0; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0f2"></a>B0F2</td>
<td class="instruction">SET 5,(IY+$07)</td>
<td class="comment-11" rowspan="1">else &lt;% IY[7] |= vischar_BYTE7_IMPEDED;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0f6"></a>B0F6</td>
<td class="instruction">JR $B0D0</td>
<td class="comment-11" rowspan="1">goto $B0D0; %&gt;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b0f8"></a>
<div class="comments">
<div class="paragraph">
New inputs.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0f8"></a>B0F8</td>
<td class="instruction">DEFB $85</td>
<td class="comment-11" rowspan="1">input_DOWN | input_LEFT  | input_KICK</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0f9"></a>B0F9</td>
<td class="instruction">DEFB $84</td>
<td class="comment-11" rowspan="1">input_UP   | input_LEFT  | input_KICK</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0fa"></a>B0FA</td>
<td class="instruction">DEFB $87</td>
<td class="comment-11" rowspan="1">input_UP   | input_RIGHT | input_KICK</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0fb"></a>B0FB</td>
<td class="instruction">DEFB $88</td>
<td class="comment-11" rowspan="1">input_DOWN | input_RIGHT | input_KICK</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0fc"></a>B0FC</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">pop_next: POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0fd"></a>B0FD</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">POP BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b0fe"></a>B0FE</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="3">next: HL += 32;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b0ff"></a>B0FF</td>
<td class="instruction">ADD A,$20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b101"></a>B101</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b102"></a>B102</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b103"></a>B103</td>
<td class="instruction">JP NZ,$AFE4</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b106"></a>B106</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return; // return with Z set</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="AF8F.html">AF8F</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#afdf">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="B107.html">B107</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20150622</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.4.</div>
</div>
</body>
</html>