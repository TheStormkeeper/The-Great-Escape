<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Great Escape: Routine at B916</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="B89C.html">B89C</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#b916">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="BACD.html">BACD</a></span></td>
</tr>
</table>
<div class="description">B916: Mask stuff.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="B866.html">B866</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b916"></a>
<div class="comments">
<div class="paragraph">
Clear the mask buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b916"></a>B916</td>
<td class="instruction">LD HL,$8100</td>
<td class="comment-11" rowspan="5">memset($8100, 0xFF, 0xA0);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b919"></a>B919</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b91b"></a>B91B</td>
<td class="instruction">LD DE,$8101</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b91e"></a>B91E</td>
<td class="instruction">LD BC,$009F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b921"></a>B921</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b923"></a>B923</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b926"></a>B926</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b927"></a>B927</td>
<td class="instruction">JR Z,$B935</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b929"></a>
<div class="comments">
<div class="paragraph">
Indoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b929"></a>B929</td>
<td class="instruction">LD HL,$81DA</td>
<td class="comment-11" rowspan="1">HL = &amp;interior_mask_data;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b92c"></a>B92C</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL; // count byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b92d"></a>B92D</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A == 0) return;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b92e"></a>B92E</td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b92f"></a>B92F</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">B = A; // iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b930"></a>B930</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="4">HL += 3; %&gt; // skip count byte, then off by 2 bytes</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b931"></a>B931</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b932"></a>B932</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b933"></a>B933</td>
<td class="instruction">JR $B93A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b935"></a>
<div class="comments">
<div class="paragraph">
Outdoors.
</div>
<div class="paragraph">
Bug? This count of 59 doesn't match NELEMS(exterior_mask_data); which is 58.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b935"></a>B935</td>
<td class="instruction">LD B,$3B</td>
<td class="comment-11" rowspan="1">else &lt;% B = NELEMS(exterior_mask_data); // 59 iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b937"></a>B937</td>
<td class="instruction">LD HL,$EC03</td>
<td class="comment-11" rowspan="1">HL = $EC03; // exterior_mask_data + 2 bytes %&gt;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b93a"></a>
<div class="comments">
<div class="paragraph">
Mask against all.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b93a"></a>B93A</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">do &lt;% PUSH BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b93b"></a>B93B</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">PUSH HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b93c"></a>B93C</td>
<td class="instruction">LD A,($81B5)</td>
<td class="comment-11" rowspan="2">A = map_position_related_x - 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b93f"></a>B93F</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b940"></a>B940</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="6">if (A &gt;= HL[0] || A + 4 &lt; HL[-1]) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b941"></a>B941</td>
<td class="instruction">JP NC,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b944"></a>B944</td>
<td class="instruction">ADD A,$04</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b946"></a>B946</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b947"></a>B947</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b948"></a>B948</td>
<td class="instruction">JP C,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b94b"></a>B94B</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b94c"></a>B94C</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b94d"></a>B94D</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b94e"></a>B94E</td>
<td class="instruction">LD A,($81B6)</td>
<td class="comment-11" rowspan="2">A = map_position_related_y - 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b951"></a>B951</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b952"></a>B952</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="6">if (A &gt;= HL[2] || A + 5 &lt; HL[1]) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b953"></a>B953</td>
<td class="instruction">JP NC,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b956"></a>B956</td>
<td class="instruction">ADD A,$05</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b958"></a>B958</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b959"></a>B959</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b95a"></a>B95A</td>
<td class="instruction">JP C,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b95d"></a>B95D</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b95e"></a>B95E</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b95f"></a>B95F</td>
<td class="instruction">LD A,($81B2)</td>
<td class="comment-11" rowspan="5">if (tinypos_stash_x &lt;= HL[3]) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b962"></a>B962</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b963"></a>B963</td>
<td class="instruction">JP Z,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b966"></a>B966</td>
<td class="instruction">JP C,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b969"></a>B969</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b96a"></a>B96A</td>
<td class="instruction">LD A,($81B3)</td>
<td class="comment-11" rowspan="4">if (tinypos_stash_y &lt; HL[4]) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b96d"></a>B96D</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b96e"></a>B96E</td>
<td class="instruction">JP C,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b971"></a>B971</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b972"></a>B972</td>
<td class="instruction">LD A,($81B4)</td>
<td class="comment-11" rowspan="1">A = tinypos_stash_height;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b975"></a>B975</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="3">if (A) A--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b976"></a>B976</td>
<td class="instruction">JR Z,$B979</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b978"></a>B978</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b979"></a>B979</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="2">if (A &gt;= HL[5]) goto pop_next;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b97a"></a>B97A</td>
<td class="instruction">JP NC,$BAC3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b97d"></a>B97D</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="5">HL -= 6;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b97e"></a>B97E</td>
<td class="instruction">SUB $06</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b980"></a>B980</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b981"></a>B981</td>
<td class="instruction">JR NC,$B984</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b983"></a>B983</td>
<td class="instruction">DEC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="b984"></a>
<div class="comments">
<div class="paragraph">
Clipping.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b984"></a>B984</td>
<td class="instruction">LD A,($81B5)</td>
<td class="comment-11" rowspan="1">A = map_position_related_x;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b987"></a>B987</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b988"></a>B988</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="2">if (A &gt;= *HL) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b989"></a>B989</td>
<td class="instruction">JP C,$B99F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b98c"></a>B98C</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">A -= *HL; // sampled HL points to $81EC $81F4 $EC12</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b98d"></a>B98D</td>
<td class="instruction">LD ($B837),A</td>
<td class="comment-11" rowspan="1">byte_B837 = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b990"></a>B990</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b991"></a>B991</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">A = *HL - C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b992"></a>B992</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b993"></a>B993</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="3">if (A &gt;= 3) A = 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b995"></a>B995</td>
<td class="instruction">JR C,$B999</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b997"></a>B997</td>
<td class="instruction">LD A,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b999"></a>B999</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="2">($B83A) = ++A; // word_B839 + 1 %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b99a"></a>B99A</td>
<td class="instruction">LD ($B83A),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b99d"></a>B99D</td>
<td class="instruction">JR $B9B6</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b99f"></a>B99F</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1">B = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a0"></a>B9A0</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">byte_B837 = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a1"></a>B9A1</td>
<td class="instruction">LD ($B837),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a4"></a>B9A4</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="6">C = 4 - (B - C);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a5"></a>B9A5</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a6"></a>B9A6</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a7"></a>B9A7</td>
<td class="instruction">LD A,$04</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9a9"></a>B9A9</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9aa"></a>B9AA</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ab"></a>B9AB</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ac"></a>B9AC</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">A = (*HL - B) + 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ad"></a>B9AD</td>
<td class="instruction">SUB B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ae"></a>B9AE</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9af"></a>B9AF</td>
<td class="instruction">CP C</td>
<td class="comment-11" rowspan="3">if (A &gt; C) A = C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9b0"></a>B9B0</td>
<td class="instruction">JR C,$B9B3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9b2"></a>B9B2</td>
<td class="instruction">LD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9b3"></a>B9B3</td>
<td class="instruction">LD ($B83A),A</td>
<td class="comment-11" rowspan="1">($B83A) = A; // word_B839 + 1 %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9b6"></a>B9B6</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9b7"></a>B9B7</td>
<td class="instruction">LD A,($81B6)</td>
<td class="comment-11" rowspan="1">A = map_position_related_y;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ba"></a>B9BA</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">C = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9bb"></a>B9BB</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="2">if (A &gt;= *HL) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9bc"></a>B9BC</td>
<td class="instruction">JP C,$B9D2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9bf"></a>B9BF</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">A -= *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9c0"></a>B9C0</td>
<td class="instruction">LD ($B838),A</td>
<td class="comment-11" rowspan="1">byte_B838 = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9c3"></a>B9C3</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">A = *++HL - C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9c4"></a>B9C4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9c5"></a>B9C5</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9c6"></a>B9C6</td>
<td class="instruction">CP $04</td>
<td class="comment-11" rowspan="3">if (A &gt;= 4) A = 4;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9c8"></a>B9C8</td>
<td class="instruction">JR C,$B9CC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ca"></a>B9CA</td>
<td class="instruction">LD A,$04</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9cc"></a>B9CC</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">A++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9cd"></a>B9CD</td>
<td class="instruction">LD ($B839),A</td>
<td class="comment-11" rowspan="2">($B839) = A; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9d0"></a>B9D0</td>
<td class="instruction">JR $B9E9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9d2"></a>B9D2</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1">else &lt;% B = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9d3"></a>B9D3</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">byte_B838 = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9d4"></a>B9D4</td>
<td class="instruction">LD ($B838),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9d7"></a>B9D7</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="6">C = 5 - (B - C);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9d8"></a>B9D8</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9d9"></a>B9D9</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9da"></a>B9DA</td>
<td class="instruction">LD A,$05</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9dc"></a>B9DC</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9dd"></a>B9DD</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9de"></a>B9DE</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="4">A = (*++HL - B) + 1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9df"></a>B9DF</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9e0"></a>B9E0</td>
<td class="instruction">SUB B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9e1"></a>B9E1</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9e2"></a>B9E2</td>
<td class="instruction">CP C</td>
<td class="comment-11" rowspan="3">if (A &gt;= C) A = C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9e3"></a>B9E3</td>
<td class="instruction">JR C,$B9E6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9e5"></a>B9E5</td>
<td class="instruction">LD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9e6"></a>B9E6</td>
<td class="instruction">LD ($B839),A</td>
<td class="comment-11" rowspan="1">($B839) = A; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9e9"></a>B9E9</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">HL--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ea"></a>B9EA</td>
<td class="instruction">LD BC,$0000</td>
<td class="comment-11" rowspan="1">BC = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ed"></a>B9ED</td>
<td class="instruction">LD A,($B838)</td>
<td class="comment-11" rowspan="7">if (byte_B838 == 0) C = -map_position_related_y + *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9f0"></a>B9F0</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9f1"></a>B9F1</td>
<td class="instruction">JR NZ,$B9FA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9f3"></a>B9F3</td>
<td class="instruction">LD A,($81B6)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9f6"></a>B9F6</td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9f8"></a>B9F8</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9f9"></a>B9F9</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="b9fa"></a>B9FA</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="2">HL -= 2;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9fb"></a>B9FB</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9fc"></a>B9FC</td>
<td class="instruction">LD A,($B837)</td>
<td class="comment-11" rowspan="7">if (byte_B837 == 0) B = -map_position_related_x + *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="b9ff"></a>B9FF</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba00"></a>BA00</td>
<td class="instruction">JR NZ,$BA09</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba02"></a>BA02</td>
<td class="instruction">LD A,($81B5)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba05"></a>BA05</td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba07"></a>BA07</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba08"></a>BA08</td>
<td class="instruction">LD B,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba09"></a>BA09</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">HL--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba0a"></a>BA0A</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">A = *HL;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba0b"></a>BA0B</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba0c"></a>BA0C</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="7">Adash = C * 32 + B;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba0d"></a>BA0D</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba0e"></a>BA0E</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba0f"></a>BA0F</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba10"></a>BA10</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba11"></a>BA11</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba12"></a>BA12</td>
<td class="instruction">ADD A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba13"></a>BA13</td>
<td class="instruction">LD HL,$8100</td>
<td class="comment-11" rowspan="3">HL = $8100 + Adash;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba16"></a>BA16</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba17"></a>BA17</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba18"></a>BA18</td>
<td class="instruction">LD ($81A0),HL</td>
<td class="comment-11" rowspan="1">($81A0) = HL; // $81A0 is a mystery location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba1b"></a>BA1B</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="ba1c"></a>
<div class="comments">
<div class="paragraph">
If I break this bit then the character gets drawn on top of *indoors* objects.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba1c"></a>BA1C</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="8">DE = exterior_mask_data_pointers[A];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba1d"></a>BA1D</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba1e"></a>BA1E</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba20"></a>BA20</td>
<td class="instruction">LD HL,$EBC5</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba23"></a>BA23</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba24"></a>BA24</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba25"></a>BA25</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba26"></a>BA26</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba27"></a>BA27</td>
<td class="instruction">LD HL,($B839)</td>
<td class="comment-11" rowspan="1">HL = word_B839;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba2a"></a>BA2A</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">($BA70) = L; // self modify</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba2b"></a>BA2B</td>
<td class="instruction">LD ($BA70),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba2e"></a>BA2E</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="2">($BA72) = H; // self modify</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba2f"></a>BA2F</td>
<td class="instruction">LD ($BA72),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba32"></a>BA32</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="3">($BA90) = *DE - H; // self modify // *DE looks like a count</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba33"></a>BA33</td>
<td class="instruction">SUB H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba34"></a>BA34</td>
<td class="instruction">LD ($BA90),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba37"></a>BA37</td>
<td class="instruction">LD A,$20</td>
<td class="comment-11" rowspan="3">($BABA) = 32 - H; // self modify</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba39"></a>BA39</td>
<td class="instruction">SUB H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba3a"></a>BA3A</td>
<td class="instruction">LD ($BABA),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba3d"></a>BA3D</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">PUSH DE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba3e"></a>BA3E</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="2">E = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba3f"></a>BA3F</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba40"></a>BA40</td>
<td class="instruction">LD A,($B838)</td>
<td class="comment-11" rowspan="1">A = byte_B838;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba43"></a>BA43</td>
<td class="instruction">CALL <a class="link" href="BACD.html">$BACD</a></td>
<td class="comment-11" rowspan="1">multiply();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba46"></a>BA46</td>
<td class="instruction">LD A,($B837)</td>
<td class="comment-11" rowspan="2">E = byte_B837;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba49"></a>BA49</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba4a"></a>BA4A</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">HL += DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba4b"></a>BA4B</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">POP DE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba4c"></a>BA4C</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++; // iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba4d"></a>BA4D</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">do &lt;% A = *DE; // DE -&gt; $E560 upwards (in exterior_mask_data)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba4e"></a>BA4E</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A &gt;= 128) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba4f"></a>BA4F</td>
<td class="instruction">JP P,$BA60</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba52"></a>BA52</td>
<td class="instruction">AND $7F</td>
<td class="comment-11" rowspan="1">A &amp;= 0x7F;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba54"></a>BA54</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba55"></a>BA55</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="2">HL -= A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba56"></a>BA56</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba58"></a>BA58</td>
<td class="instruction">JR C,$BA69</td>
<td class="comment-11" rowspan="1">if (HL &lt; 0) goto $BA69;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba5a"></a>BA5A</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++; // doesn't affect flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba5b"></a>BA5B</td>
<td class="instruction">JR NZ,$BA4D</td>
<td class="comment-11" rowspan="1">if (HL != 0) goto $BA4D;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba5d"></a>BA5D</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">A = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba5e"></a>BA5E</td>
<td class="instruction">JR $BA6C</td>
<td class="comment-11" rowspan="1">goto $BA6C; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba60"></a>BA60</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba61"></a>BA61</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="4">%&gt; while (--HL);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba62"></a>BA62</td>
<td class="instruction">LD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba63"></a>BA63</td>
<td class="instruction">OR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba64"></a>BA64</td>
<td class="instruction">JP NZ,$BA4D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba67"></a>BA67</td>
<td class="instruction">JR $BA6C</td>
<td class="comment-11" rowspan="1">goto $BA6C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba69"></a>BA69</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">A = -L;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba6a"></a>BA6A</td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba6c"></a>BA6C</td>
<td class="instruction">LD HL,($81A0)</td>
<td class="comment-11" rowspan="1">HL = ($81A0); // mystery</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba6f"></a>BA6F</td>
<td class="instruction">LD C,$01</td>
<td class="comment-11" rowspan="1">C = 1; // self modified</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba71"></a>BA71</td>
<td class="instruction">LD B,$01</td>
<td class="comment-11" rowspan="1">do &lt;% B = 1; // self modified</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba73"></a>BA73</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">do &lt;% -</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba74"></a>BA74</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Adash = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba75"></a>BA75</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Adash &amp;= Adash;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba76"></a>BA76</td>
<td class="instruction">JP P,$BA7E</td>
<td class="comment-11" rowspan="1">if (!P) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba79"></a>BA79</td>
<td class="instruction">AND $7F</td>
<td class="comment-11" rowspan="1">Adash &amp;= 0x7F;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba7b"></a>BA7B</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba7c"></a>BA7C</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba7d"></a>BA7D</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">A = *DE; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba7e"></a>BA7E</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">A &amp;= A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba7f"></a>BA7F</td>
<td class="instruction">CALL NZ,<a class="link" href="BADC.html">$BADC</a></td>
<td class="comment-11" rowspan="1">if (!Z) mask_against_tile();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba82"></a>BA82</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">L++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba83"></a>BA83</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF' // unpaired?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba84"></a>BA84</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="5">if (A != 0 &amp;&amp; --A != 0) DE--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba85"></a>BA85</td>
<td class="instruction">JR Z,$BA8B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba87"></a>BA87</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba88"></a>BA88</td>
<td class="instruction">JR Z,$BA8B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba8a"></a>BA8A</td>
<td class="instruction">DEC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba8b"></a>BA8B</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba8c"></a>BA8C</td>
<td class="instruction">DJNZ $BA73</td>
<td class="comment-11" rowspan="1">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba8e"></a>BA8E</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">PUSH BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba8f"></a>BA8F</td>
<td class="instruction">LD B,$01</td>
<td class="comment-11" rowspan="1">B = 1; // self modified</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba91"></a>BA91</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba92"></a>BA92</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="3">if (B) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba93"></a>BA93</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba94"></a>BA94</td>
<td class="instruction">JP Z,$BAB9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba97"></a>BA97</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba98"></a>BA98</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A) goto $BAA3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba99"></a>BA99</td>
<td class="instruction">JR NZ,$BAA3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="ba9b"></a>BA9B</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">do &lt;% A = *DE;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba9c"></a>BA9C</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A &gt;= 128) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="ba9d"></a>BA9D</td>
<td class="instruction">JP P,$BAAF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa0"></a>BAA0</td>
<td class="instruction">AND $7F</td>
<td class="comment-11" rowspan="1">A &amp;= 0x7F;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa2"></a>BAA2</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="baa3"></a>BAA3</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="4">B -= A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa4"></a>BAA4</td>
<td class="instruction">LD A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa5"></a>BAA5</td>
<td class="instruction">SUB C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa6"></a>BAA6</td>
<td class="instruction">LD B,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa7"></a>BAA7</td>
<td class="instruction">JR C,$BAB6</td>
<td class="comment-11" rowspan="1">if (B &lt; 0) goto $BAB6;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baa9"></a>BAA9</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++; // doesn't affect flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baaa"></a>BAAA</td>
<td class="instruction">JR NZ,$BA9B</td>
<td class="comment-11" rowspan="1">if (B != 0) goto $BA9B;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baac"></a>BAAC</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF' // why not just jump instr earlier? // bank</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baad"></a>BAAD</td>
<td class="instruction">JR $BAB9</td>
<td class="comment-11" rowspan="1">goto $BAB9; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="baaf"></a>BAAF</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="1">DE++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bab0"></a>BAB0</td>
<td class="instruction">DJNZ $BA9B</td>
<td class="comment-11" rowspan="1">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bab2"></a>BAB2</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">A = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bab3"></a>BAB3</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF' // why not just jump instr earlier? // bank</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bab4"></a>BAB4</td>
<td class="instruction">JR $BAB9</td>
<td class="comment-11" rowspan="1">goto $BAB9;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="bab6"></a>BAB6</td>
<td class="instruction">NEG</td>
<td class="comment-11" rowspan="1">A = -A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bab8"></a>BAB8</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF' // bank %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="bab9"></a>BAB9</td>
<td class="instruction">LD A,$20</td>
<td class="comment-11" rowspan="3">HL += 32; // self modified</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="babb"></a>BABB</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="babc"></a>BABC</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="babd"></a>BABD</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">EX AF,AF'  // unbank</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="babe"></a>BABE</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">POP BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="babf"></a>BABF</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="2">%&gt; while (--C);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bac0"></a>BAC0</td>
<td class="instruction">JP NZ,$BA71</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="bac3"></a>BAC3</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">pop_next: POP HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bac4"></a>BAC4</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">POP BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bac5"></a>BAC5</td>
<td class="instruction">LD DE,$0008</td>
<td class="comment-11" rowspan="2">HL += 8;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bac8"></a>BAC8</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="bac9"></a>BAC9</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="baca"></a>BACA</td>
<td class="instruction">JP NZ,$B93A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">

<div class="comments">
<div class="paragraph">
Bug: Looks like a RET is missing here. We fall through into multiply.
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="B89C.html">B89C</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#b916">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="BACD.html">BACD</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The incomplete The Great Escape disassembly 20150622</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.4.</div>
</div>
</body>
</html>